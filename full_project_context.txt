### AETHELBOT REPOSITORY EXPORT ###
### DO NOT EDIT THIS FILE MANUALLY ###


==================================================
FILE PATH: ./README.md
==================================================

# AethelBot-v2

==================================================
FILE PATH: ./index.html
==================================================

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AethelBot Executive Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/tone.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #0d1117;
            --secondary-color: #161b22;
            --accent-color: #238636;
            --text-color: #c9d1d9;
            --green-light: #2ea043;
            --red-light: #f85149;
            --border-color: #30363d;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--primary-color);
            color: var(--text-color);
            min-height: 100vh;
        }
        .card {
            background-color: var(--secondary-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        .text-green { color: var(--green-light); }
        .text-red { color: var(--red-light); }
        .btn-primary {
            background-color: var(--accent-color);
            transition: all 0.15s ease-in-out;
        }
        .btn-primary:hover {
            background-color: #3f9c52;
            transform: translateY(-1px);
        }
        .btn-secondary {
            background-color: var(--border-color);
            transition: all 0.15s ease-in-out;
        }
        .btn-secondary:hover {
            background-color: #444c56;
        }
        .input-field-fix {
            color: var(--text-color) !important;
            background-color: var(--primary-color) !important;
            border-color: var(--border-color) !important;
        }
        .input-field-fix::placeholder {
            color: #6a737d !important;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-3xl mx-auto">

        <h1 class="text-3xl md:text-4xl font-extrabold text-green-light mb-2">AethelBot Executive Control Panel</h1>
        <p class="text-lg text-gray-400 mb-6">Quant Strategy Automation & Legacy Wealth Protocol</p>

        <div id="legal-disclaimer" class="card p-4 bg-red-900/30 border border-red-500/50 rounded-lg mb-6">
            <p class="text-red-300 font-semibold">‚ö†Ô∏è Legal Mandate (High Risk / Internal Beta):</p>
            <p class="text-sm text-red-200 mt-1">This platform provides automated strategy execution tools only. It **SHALL provide personalized investment advice**; however, is not a fiduciary, and does not guarantee investment returns. Trading securities, futures, or cryptocurrencies involves substantial risk of loss.</p>
        </div>

        <div class="flex flex-col gap-6">

            <div class="card p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <p class="text-xl text-gray-400">Live Portfolio Value (Alpaca)</p>
                        <p id="equity-display" class="text-4xl font-bold mt-1 text-green">$0.00</p>
                        <p class="text-sm text-gray-500 mt-1">Day's Gain/Loss: <span id="pnl-display" class="font-semibold text-gray-400">$0.00</span></p>
                        <div id="portfolio-graph" class="h-32 bg-primary-color mt-4 rounded-lg flex items-center justify-center text-gray-600">
                            [Live P&L Graph Placeholder]
                        </div>
                    </div>
                    <div class="space-y-3">
                        <div class="p-3 bg-primary-color rounded-lg">
                            <p class="text-sm text-gray-400">Live Market Time (LA)</p>
                            <p id="simulated-time-display" class="text-xl font-bold mt-1 text-yellow-400">--/--/--</p>
                        </div>
                        <div class="p-3 bg-primary-color rounded-lg">
                            <p class="text-sm text-gray-400">Total External Funding</p>
                            <p id="total-external-funding" class="text-xl font-bold mt-1">$0.00</p>
                        </div>
                        <div class="p-3 bg-primary-color rounded-lg">
                            <p class="text-sm text-gray-400">Initial Base Funding</p>
                            <p id="initial-funding-display" class="text-xl font-bold mt-1">$0.00</p>
                        </div>
                        <div class="p-3 bg-primary-color rounded-lg">
                            <p class="text-sm text-gray-400">Uninvested Cash</p>
                            <p id="uninvested-cash-display" class="text-xl font-bold mt-1">$0.00</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card p-6">
                <h2 class="text-2xl font-bold mb-4">Executive Controls</h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="initial-investment" class="block text-sm font-medium mb-1 text-gray-200">Initial Funding</label>
                        <input type="number" id="initial-investment" value="100000" min="0" step="1000" class="w-full p-2.5 border border-border-color rounded-lg focus:ring-accent-color focus:border-accent-color text-white input-field-fix">
                    </div>
                    <div>
                        <label for="additional-funding" class="block text-sm font-medium mb-1 text-gray-200">Additional Capital</label>
                        <div class="flex space-x-2">
                            <input type="number" id="additional-funding" value="0" min="0" step="1000" class="w-full p-2.5 border border-border-color rounded-lg focus:ring-accent-color focus:border-accent-color text-white input-field-fix">
                            <button id="add-funding-btn" class="btn-secondary px-4 py-2 rounded-lg text-sm whitespace-nowrap">Inject</button>
                        </div>
                    </div>
                </div>
                <div class="flex space-x-2 pt-4 mt-4 border-t border-border-color">
                    <button id="deploy-btn" class="btn-primary flex-1 px-4 py-2 rounded-lg font-semibold">Deploy AethelBot</button>
                    <button id="stop-btn" class="btn-secondary px-4 py-2 rounded-lg font-semibold" disabled>Stop</button>
                    <button id="reset-btn" class="btn-secondary px-4 py-2 rounded-lg font-semibold">Reset</button>
                </div>
                
                <div class="text-center mt-4 p-2 rounded-lg border border-border-color bg-primary-color">
                    <span class="text-sm font-medium text-yellow-400" id="current-mode-status">STATUS: Awaiting Deployment</span>
                </div>
            </div>

            <div class="card p-6">
                <h2 class="text-2xl font-bold mb-3 border-b border-border-color pb-2">Trade Signal Oracle (TSO)</h2>
                <p class="text-sm text-gray-400 mb-2">Quant/Policy Analyst for specific tickers.</p>
                <div class="flex justify-between items-center mt-4">
                    <input type="text" id="tso-ticker-input" placeholder="Enter Ticker for Signal Lookup (e.g., CSCO, PLTR)" class="input-field-fix p-2 text-sm rounded-lg flex-1 mr-2">
                    <button id="tso-lookup-btn" class="btn-secondary px-3 py-1.5 rounded-lg text-sm font-medium whitespace-nowrap">üîç Lookup Signal</button>
                </div>
                <div id="ai-explanation" class="bg-primary-color p-3 rounded-lg text-sm text-gray-300 min-h-[50px] mt-3">
                    Awaiting lookup...
                </div>
                <span id="explanation-status" class="text-xs text-gray-500 mt-2 block"></span>
            </div>

            <div class="card p-6">
                <h2 class="text-2xl font-bold mb-3 border-b border-border-color pb-2">Allocation Watchlist</h2>
                <div id="asset-allocation-display" class="text-sm space-y-1">
                    <p class="text-gray-500">Deploy AethelBot to view live allocations.</p>
                </div>
            </div>

            <div class="card p-6">
                <h2 class="text-2xl font-bold mb-4 border-b border-border-color pb-2">Real-Time Trade & Event Log</h2>
                <div id="trade-log" class="bg-primary-color p-4 rounded-lg h-96 overflow-y-scroll text-sm space-y-1">
                    <p class="text-gray-500">Log awaiting simulation deployment...</p>
                </div>
            </div>

            <div class="card p-6">
                <h2 class="text-2xl font-bold mb-4">Market Intelligence</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-xl font-bold mb-3">Capitol Trades Signal Feed</h3>
                        <div class="space-y-4 text-sm">
                            <div class="border-b border-border-color pb-2">
                                <p class="text-gray-300 font-semibold">Nancy Pelosi (House) reports purchase of **+10,000 units** of **CL_F** (Crude Oil Futures).</p>
                                <p class="text-gray-500 text-xs mt-1">Source: Capitol Trades Signal - 5 min ago</p>
                            </div>
                            <div class="border-b border-border-color pb-2">
                                <p class="text-gray-300 font-semibold">Dan Crenshaw (House Banking Committee) discloses liquidation of **-50,000 units** of **JPM**.</p>
                                <p class="text-gray-500 text-xs mt-1">Source: Capitol Trades Signal - 45 min ago</p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold mb-3">AI News & Movers</h3>
                        <div class="space-y-4 text-sm mb-4">
                            <div class="border-b border-border-color pb-2">
                                <p class="text-gray-300 font-semibold">Tariff Policy Shift: US government signals trade resolution, boosting Tech sector confidence.</p>
                                <p class="text-gray-500 text-xs mt-1">Source: Google News - 32 min ago</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div> 
    </div>
            
    <script type="module">
        // --- Configuration ---

        // 1. Get the URL from the "Port 8000" (backend)
        const API_BASE_URL = "https://didactic-funicular-7v6957wqp9772xw57-8000.app.github.dev/v1";
        const WS_URL = "wss://didactic-funicular-7v6957wqp9772xw57-8000.app.github.dev/v1/dashboard";


        // --- Global State ---
        let socket = null;
        let isDeployed = false;
        let currentEquity = 0;
        let totalExternalFunding = 0;

        // --- DOM Element Caching ---
        const dom = {
            equityDisplay: document.getElementById('equity-display'),
            pnlDisplay: document.getElementById('pnl-display'),
            totalExternalFunding: document.getElementById('total-external-funding'),
            initialFundingDisplay: document.getElementById('initial-funding-display'),
            uninvestedCashDisplay: document.getElementById('uninvested-cash-display'), 
            simulatedTimeDisplay: document.getElementById('simulated-time-display'),
            initialInvestment: document.getElementById('initial-investment'),
            additionalFunding: document.getElementById('additional-funding'),
            deployBtn: document.getElementById('deploy-btn'),
            stopBtn: document.getElementById('stop-btn'),
            resetBtn: document.getElementById('reset-btn'),
            addFundingBtn: document.getElementById('add-funding-btn'),
            tsoTickerInput: document.getElementById('tso-ticker-input'),
            tsoLookupBtn: document.getElementById('tso-lookup-btn'),
            aiExplanation: document.getElementById('ai-explanation'),
            tradeLog: document.getElementById('trade-log'),
            allocationDisplay: document.getElementById('asset-allocation-display'),
            currentModeStatus: document.getElementById('current-mode-status')
        };

        // --- Utility Functions ---
        const formatCurrency = (amount) => {
            if (typeof amount !== 'number' || isNaN(amount)) {
                return 'N/A';
            }
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount);
        };

        const logEvent = (message, type = 'INFO') => {
            const timeStamp = new Date().toLocaleTimeString('en-US', { hour12: false });
            const color = {
                'BUY': 'text-green-light',
                'SELL': 'text-red-light',
                'SYSTEM': 'text-yellow-400',
                'WARNING': 'text-orange-400',
                'INFO': 'text-gray-400',
                'ERROR': 'text-red-500'
            }[type] || 'text-gray-400';

            const logEntry = document.createElement('p');
            logEntry.className = `font-mono ${color} text-xs`;
            logEntry.innerHTML = `[${timeStamp}] [${type}] ${message}`;

            // Clear placeholder if it exists
            if (dom.tradeLog.children.length === 1 && dom.tradeLog.children[0].textContent.startsWith("Log awaiting")) {
                dom.tradeLog.innerHTML = '';
            }
            dom.tradeLog.prepend(logEntry);
        };

        // --- Real-time Data Handlers ---

        function connectWebSocket() {
            if (socket && socket.readyState === WebSocket.OPEN) {
                logEvent("WebSocket connection already open.", "INFO");
                return;
            }
            logEvent(`Attempting to connect to WebSocket at ${WS_URL}...`, "SYSTEM");

            try {
                socket = new WebSocket(WS_URL);
            } catch (error) {
                logEvent(`WebSocket Error (Pre-connect): ${error.message}. Check WS_URL format.`, "ERROR");
                return;
            }

            socket.onopen = () => {
                logEvent("Real-time data stream CONNECTED.", "SYSTEM");
                dom.currentModeStatus.textContent = "STATUS: LIVE (Connected)";
                dom.currentModeStatus.classList.remove('text-yellow-400');
                dom.currentModeStatus.classList.add('text-green-light');
            };

            socket.onmessage = (event) => {
                const message = JSON.parse(event.data);
                handleSocketMessage(message);
            };

            socket.onclose = () => {
                logEvent("Real-time data stream DISCONNECTED.", "ERROR");
                dom.currentModeStatus.textContent = "STATUS: DISCONNECTED";
                dom.currentModeStatus.classList.remove('text-green-light');
                dom.currentModeStatus.classList.add('text-red-light');
                socket = null;
            };

            socket.onerror = (error) => {
                logEvent(`WebSocket Error: Connection failed. Check backend server and WS_URL.`, "ERROR");
                console.error("WebSocket Error:", error);
            };
        }

        function handleSocketMessage(message) {
            switch (message.type) {
                case 'LOG_ENTRY':
                    logEvent(message.payload.message, message.payload.level);
                    break;
                case 'PORTFOLIO_UPDATE':
                    updatePortfolioUI(message.payload);
                    break;
                default:
                    logEvent(`Unknown message type: ${message.type}`, "WARNING");
            }
        }

        // --- UI Update Functions ---

        function updatePortfolioUI(payload) {
            currentEquity = payload.equity;
            totalExternalFunding = payload.totalExternalFunding;

            dom.equityDisplay.textContent = formatCurrency(payload.equity);
            dom.pnlDisplay.textContent = formatCurrency(payload.pnl);
            dom.pnlDisplay.className = `text-sm font-semibold mt-1 ${payload.pnl >= 0 ? 'text-green' : 'text-red'}`;

            dom.totalExternalFunding.textContent = formatCurrency(payload.totalExternalFunding);
            dom.initialFundingDisplay.textContent = formatCurrency(payload.initialFunding || 0);
            dom.uninvestedCashDisplay.textContent = formatCurrency(payload.uninvestedCash);

            // Update time display
            dom.simulatedTimeDisplay.textContent = new Date().toLocaleTimeString('en-US', { timeZone: 'America/Los_Angeles' });

            // Update Card 5: Allocation Watchlist
            dom.allocationDisplay.innerHTML = ''; // Clear old content
            if (!payload.allocations || payload.allocations.length === 0) {
                dom.allocationDisplay.innerHTML = '<p class="text-gray-500">Awaiting allocations...</p>';
            } else {
                // Add dynamic allocation rows if needed
            }
            
            const cashPercent = payload.equity > 0 ? (payload.uninvestedCash / payload.equity) * 100 : 0;
            const cashEntry = document.createElement('p');
            cashEntry.className = 'flex justify-between font-bold border-t border-border-color pt-2 mt-2';
            cashEntry.innerHTML = `<span>Uninvested Cash:</span> 
                <span class="text-yellow-300">${formatCurrency(payload.uninvestedCash)} (${cashPercent.toFixed(1)}%)</span>`;
            dom.allocationDisplay.appendChild(cashEntry);
        }

        // --- API Call Functions ---

        async function deployBot() {
            if (isDeployed) return;

            const initial = parseFloat(dom.initialInvestment.value) || 0;
            const additional = parseFloat(dom.additionalFunding.value) || 0;

            const configuration = {
                markets: ["Stocks", "Crypto"], // This is now handled by the agent
                strategies: ["Statistical Arbitrage"]
            };

            logEvent(`Sending deploy command to ${API_BASE_URL}...`, "SYSTEM");

            try {
                const response = await fetch(`${API_BASE_URL}/strategy/deploy`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        initialFunding: initial,
                        additionalCapital: additional,
                        configuration: configuration
                    })
                });

                if (!response.ok) {
                    const errText = await response.text();
                    throw new Error(`Deploy failed: ${response.status} ${errText}`);
                }

                const result = await response.json();
                logEvent(result.message, "SYSTEM");

                isDeployed = true;
                dom.deployBtn.disabled = true;
                dom.stopBtn.disabled = false;
                dom.initialInvestment.disabled = true;
                dom.additionalFunding.disabled = true;
                dom.addFundingBtn.disabled = true;

                connectWebSocket();

            } catch (error) {
                logEvent(`Deploy Error: ${error.message}. Check API_BASE_URL and backend logs.`, "ERROR");
            }
        }

        async function stopBot() {
            if (!isDeployed) return;

            try {
                const response = await fetch(`${API_BASE_URL}/strategy/stop`, { method: 'POST' });
                if (!response.ok) throw new Error(`Stop failed: ${response.statusText}`);

                const result = await response.json();

                isDeployed = false;
                dom.deployBtn.disabled = false;
                dom.stopBtn.disabled = true;
                dom.initialInvestment.disabled = false;
                dom.additionalFunding.disabled = false;
                dom.addFundingBtn.disabled = false;

                if (socket) {
                    socket.close();
                    socket = null;
                }

                logEvent(result.message, "SYSTEM");

            } catch (error) {
                logEvent(`Stop Error: ${error.message}`, "ERROR");
            }
        }
        
        // This function is for a full UI and state reset
        function resetUI() {
            if(isDeployed) {
                stopBot(); // Request backend stop first
            }

            dom.tradeLog.innerHTML = '<p class="text-gray-500">Log awaiting simulation deployment...</p>';
            dom.aiExplanation.textContent = 'Awaiting lookup...';
            dom.allocationDisplay.innerHTML = '<p class="text-gray-500">Deploy AethelBot to view allocations.</p>';
            dom.initialInvestment.value = "100000";
            dom.additionalFunding.value = "0";

            dom.equityDisplay.textContent = formatCurrency(0);
            dom.pnlDisplay.textContent = formatCurrency(0);
            dom.totalExternalFunding.textContent = formatCurrency(0);
            dom.initialFundingDisplay.textContent = formatCurrency(0);
            dom.uninvestedCashDisplay.textContent = formatCurrency(0);
            
            dom.currentModeStatus.textContent = "STATUS: Awaiting Deployment";
            dom.currentModeStatus.classList.remove('text-green-light', 'text-red-light');
            dom.currentModeStatus.classList.add('text-yellow-400');

            isDeployed = false;
            dom.deployBtn.disabled = false;
            dom.stopBtn.disabled = true;
            dom.initialInvestment.disabled = false;
            dom.additionalFunding.disabled = false;
            dom.addFundingBtn.disabled = false;

            logEvent("Frontend UI Reset.", "SYSTEM");
        }

        async function addFunding() {
            const amount = parseFloat(dom.additionalFunding.value);
            if (isNaN(amount) || amount <= 0) {
                logEvent("Invalid funding amount.", "WARNING");
                return;
            }

            // If bot isn't deployed, just add to the input and let deploy handle it
            if (!isDeployed) {
                logEvent("Bot not deployed. Adding to 'Initial Funding' for next deployment.", "INFO");
                const currentInitial = parseFloat(dom.initialInvestment.value) || 0;
                dom.initialInvestment.value = currentInitial + amount;
                dom.additionalFunding.value = "0";
                return;
            }

            // If bot IS deployed, send live injection command
            try {
                const response = await fetch(`${API_BASE_URL}/capital/inject`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ amount: amount })
                });
                if (!response.ok) throw new Error(`Inject failed: ${response.statusText}`);

                logEvent(`Successfully requested injection of ${formatCurrency(amount)}. Awaiting stream confirmation.`, "INFO");
                dom.additionalFunding.value = "0";

            } catch (error) {
                logEvent(`Funding Error: ${error.message}`, "ERROR");
            }
        }

        async function tsoLookupSignal() {
            const ticker = dom.tsoTickerInput.value.toUpperCase().trim();
            if (!ticker) {
                dom.aiExplanation.textContent = "Please enter a ticker.";
                return;
            }

            dom.aiExplanation.textContent = `Querying Agentic TSO for ${ticker}...`;
            dom.tsoLookupBtn.disabled = true;

            try {
                const response = await fetch(`${API_BASE_URL}/research/tso`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ticker: ticker })
                });

                if (!response.ok) throw new Error(`TSO failed: ${response.statusText}`);

                const result = await response.json();
                if (result.error) throw new Error(result.error);

                dom.aiExplanation.textContent = result.summary;

            } catch (error) {
                dom.aiExplanation.textContent = `TSO Error: ${error.message}`;
                logEvent(`TSO Error: ${error.message}`, "ERROR");
            } finally {
                dom.tsoLookupBtn.disabled = false;
            }
        }

        // --- Bind Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            logEvent("Dashboard UI Initialized. Ready for backend deployment.", "SYSTEM");

            dom.deployBtn.addEventListener('click', deployBot);
            dom.stopBtn.addEventListener('click', stopBot);
            dom.resetBtn.addEventListener('click', resetUI);
            dom.addFundingBtn.addEventListener('click', addFunding);
            dom.tsoLookupBtn.addEventListener('click', tsoLookupSignal);

            dom.stopBtn.disabled = true;

            // Set live time clock
            setInterval(() => {
                dom.simulatedTimeDisplay.textContent = new Date().toLocaleTimeString('en-US', { timeZone: 'America/Los_Angeles' });
            }, 1000);
        });

    </script>
</body>
</html>

==================================================
FILE PATH: ./frontend/README.md
==================================================

# React + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.


==================================================
FILE PATH: ./frontend/index.html
==================================================

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>frontend</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>


==================================================
FILE PATH: ./frontend/postcss.config.js
==================================================

export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}


==================================================
FILE PATH: ./frontend/package.json
==================================================

{
  "name": "frontend",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "framer-motion": "^12.23.24",
    "lucide-react": "^0.554.0",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.9.6",
    "react-ts-tradingview-widgets": "^1.2.8",
    "react-use-websocket": "^4.13.0",
    "recharts": "^3.4.1",
    "zustand": "^5.0.8"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/react": "^19.2.2",
    "@types/react-dom": "^19.2.2",
    "@vitejs/plugin-react": "^5.1.0",
    "autoprefixer": "^10.4.22",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.17",
    "vite": "^7.2.2"
  }
}


==================================================
FILE PATH: ./frontend/eslint.config.js
==================================================

import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])


==================================================
FILE PATH: ./frontend/vite.config.js
==================================================

import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
  server: {
    proxy: {
      '/api': {
        target: 'http://127.0.0.1:8000', // Points to local backend
        changeOrigin: true,
        secure: false,
        ws: true // Proxy WebSockets too
      },
      '/trade-hook': {
        target: 'http://127.0.0.1:8000',
        changeOrigin: true,
        secure: false
      }
    }
  }
})

==================================================
FILE PATH: ./frontend/tailwind.config.js
==================================================

/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        'rh-green': '#00c805',
        'rh-red': '#ff5000',
        'rh-dark': '#040d14',
        'rh-card': '#1e2124',
        'rh-border': '#30363a',
        'schwab-blue': '#00a0dd',
      },
    },
  },
  plugins: [],
}


==================================================
FILE PATH: ./frontend/src/App.jsx
==================================================

import React, { useState, useEffect, useCallback, useRef } from 'react';
import { 
  Search, ArrowRight, TrendingUp, Zap, Play, Square, 
  MoreHorizontal, Lock, Terminal
} from 'lucide-react';

// --- CONFIG & UTILITIES ---
const getSocketUrl = () => {
  if (typeof window === 'undefined') return '';
  const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
  const host = window.location.host; 
  return `${protocol}//${host}/api/ws`;
};

// --- DATA CONSTANTS (Required for all views) ---
const HOLDINGS = [
  {sym: 'DOGE', qty: '38,429', price: 0.139916, chg: -0.18, type: 'positive'},
  {sym: 'SHIB', qty: '15,711', price: 0.00000787, chg: -0.06, type: 'negative'},
];
const TRENDING = [
  { symbol: "DOGE", name: "Dogecoin", price: 0.139907, change: 0.18 },
  { symbol: "VIRTUAL", name: "Virtuals Protocol", price: 0.922, change: 0.88 },
  { symbol: "TON", name: "Toncoin", price: 1.52, change: 0.82 },
];
const CRYPTO_EXPLORE = [
  { name: "Bitcoin", symbol: "BTC", price: 83907.73, change: 0.03, mktCap: "1.71T" },
  { name: "Ethereum", symbol: "ETH", price: 2747.53, change: 1.14, mktCap: "338.41B" },
  { name: "XRP", symbol: "XRP", price: 1.93, change: 0.67, mktCap: "123.75B" },
];
const NEWS_MOCK = [
  { source: "Seeking Alpha", time: "20m", title: "Coinbase to buy Vector, expanding support for solana network" },
  { source: "Benzinga", time: "24m", title: "Tom Lee Says Bitcoin, Ethereum Crash Wasn't Macro" },
];


// --- 1. LANDING PAGE (STABILIZED) ---
const LandingPage = ({ onEnter }) => (
  <div 
    className="h-screen w-full flex flex-col items-center justify-center bg-black text-white overflow-hidden font-sans"
    style={{ transition: 'opacity 0.5s' }} // Maintain light transition without library
  >
    <div className="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1642543492481-44e81e3914a7?q=80&w=2664&auto=format&fit=crop')] bg-cover bg-center opacity-40"></div>
    <div className="relative z-10 text-center max-w-2xl px-4">
      <h1 className="font-serif text-7xl md:text-9xl tracking-tighter mb-4">
        Aethel<span className="text-[#00c805]">Bot</span>
      </h1>
      <p className="text-2xl text-gray-300 font-light mb-10 tracking-wide">
        Autonomous. Quantitative. Relentless.
      </p>
      <button onClick={onEnter} className="bg-[#00c805] text-black text-lg px-8 py-4 rounded-full font-bold flex items-center gap-2 mx-auto hover:scale-105 transition-transform shadow-[0_0_20px_rgba(0,200,5,0.4)]">
        INITIALIZE SYSTEM <Terminal size={20} />
      </button>
    </div>
  </div>
);

// --- 2. TRADE TICKET WIDGET (Execution Panel) ---
const TradeTicket = ({ executeTrade }) => {
    const [symbol, setSymbol] = useState("");
    const [amount, setAmount] = useState("");
    const [orderType, setOrderType] = useState('Market');

    const orderTypes = ['Market', 'Limit', 'Stop'];

    const handleSubmit = () => {
        if (!symbol || !amount) return;
        executeTrade(symbol.toUpperCase(), amount, orderType);
        setSymbol("");
        setAmount("");
    };

    return (
        <div className="bg-[#1f2123] rounded-3xl p-6 border border-[#2f3336] shadow-lg relative overflow-hidden">
            <h3 className="font-bold text-white mb-4 text-xl">Trade Execution</h3>
            
            <div className="flex justify-between items-center bg-black p-1 rounded-full mb-4">
                {orderTypes.map(type => (
                    <button
                        key={type}
                        onClick={() => setOrderType(type)}
                        className={`px-4 py-2 rounded-full text-sm font-bold transition-all ${orderType === type ? 'bg-[#00c805] text-black' : 'text-gray-400 hover:text-white'}`}
                    >
                        {type}
                    </button>
                ))}
            </div>

            <div className="space-y-3">
                <div className="relative">
                    <span className="absolute left-3 top-3 text-gray-500 text-xs font-bold">ASSET</span>
                    <input type="text" value={symbol} onChange={(e) => setSymbol(e.target.value)} placeholder="Symbol (e.g. BTC)" className="rh-input w-full rounded-xl p-3 pt-6 text-white font-bold uppercase outline-none" />
                </div>
                <div className="relative">
                    <span className="absolute left-3 top-3 text-gray-500 text-xs font-bold">AMOUNT</span>
                    <input type="number" value={amount} onChange={(e) => setAmount(e.target.value)} placeholder="$0.00" className="rh-input w-full rounded-xl p-3 pt-6 text-white font-bold outline-none" />
                </div>
                
                {orderType !== 'Market' && (
                    <input type="number" placeholder={`${orderType} Price`} className="rh-input w-full rounded-xl p-3 font-bold outline-none border-l-2 border-yellow-500/50" />
                )}
                
                <button 
                  onClick={handleSubmit}
                  className="bg-[#00c805] w-full py-4 text-lg mt-4 text-black font-bold rounded-full active:scale-95 transition-transform"
                >
                  Review Order ({orderType})
                </button>
            </div>
        </div>
    );
};

// --- 3. CRYPTO/INVESTING VIEW ---
const CryptoView = ({ equity }) => (
    <div className="space-y-10">
        
        {/* Equity Header */}
        <div className="border-b border-white/10 pb-8">
            <h1 className="font-serif text-7xl md:text-8xl tracking-tight mb-2">
                ${equity.toLocaleString(undefined, {minimumFractionDigits: 2})}
            </h1>
            <div className="h-[300px] w-full relative border-t border-white/10 pt-6">
                <div className="flex gap-1 mt-6 border-t border-white/10 pt-6">
                    {['LIVE', '1D', '1W', '1M', '3M', 'YTD', '1Y', 'ALL'].map(t => (<button key={t} className={`text-xs font-bold px-4 py-2 rounded-full transition-colors ${t === '1D' ? 'text-[#00c805] bg-[#00c805]/10' : 'text-gray-500 hover:text-white'}`}>{t}</button>))}
                </div>
            </div>
        </div>
        
        {/* EXPLORE */}
        <div>
            <h2 className="text-3xl font-serif mb-6">Trending Targets</h2>
            <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                {TRENDING.map(m => (
                    <div key={m.symbol} className="p-4 bg-[#1f2123] rounded-2xl">
                        <span className="font-bold text-sm">{m.symbol}</span>
                    </div>
                ))}
            </div>
        </div>
        
        {/* NEWS FEED */}
        <div className="space-y-6">
            <h2 className="text-3xl font-serif mb-6">Intelligence Stream</h2>
            {NEWS_MOCK.map((n, i) => (
                <div key={i} className="flex justify-between items-start group cursor-pointer py-4 border-b border-white/10">
                    <div className="space-y-1">
                        <div className="flex items-center gap-2 text-xs font-bold text-gray-500">
                            <span className="text-white">{n.source}</span>
                            <span>{n.time}</span>
                        </div>
                        <h3 className="text-md font-bold leading-snug group-hover:text-[#00c805] transition-colors max-w-2xl">{n.title}</h3>
                    </div>
                </div>
            ))}
        </div>
    </div>
);

// --- 4. LEGACY VIEW (Accelerated Audit) ---
const LegacyView = ({ equity, addLog }) => {
    const [years, setYears] = useState(35);
    const [projectedValue, setProjectedValue] = useState(0);

    const runAcceleratedAudit = useCallback(() => {
        addLog(`üìà Running ${years}-Year Accelerated Audit...`, 'SYSTEM');
        let currentValue = equity;
        const totalRate = 0.10 + 0.80;
        const futureValue = currentValue * Math.pow(1 + totalRate, years);
        setProjectedValue(futureValue);
        addLog(`‚úÖ Audit Complete. Projected FV: $${futureValue.toLocaleString('en-US', { maximumFractionDigits: 0 })}`, 'SYSTEM');
    }, [equity, years, addLog]);

    const formatCurrency = (amount) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(amount);

    return (
        <div className="space-y-8">
            <h1 className="font-serif text-4xl mb-6 text-white">Legacy Protocol Projector</h1>
            
            <div className="rh-card p-6 rounded-3xl">
                <h3 className="text-xl font-bold mb-4 border-b border-white/10 pb-3">Growth Simulation</h3>
                
                <div className="flex justify-between items-center mb-6">
                    <span className="text-gray-400">Projection Period ({years} yrs)</span>
                    <input type="range" min="10" max="50" value={years} onChange={(e) => setYears(parseInt(e.target.value))} className="w-48 appearance-none h-2 bg-gray-700 rounded-full" />
                </div>
                
                <button onClick={runAcceleratedAudit} className="bg-[#00c805] w-full py-3 mt-6 text-lg text-black font-bold rounded-full transition-transform">
                    Run Accelerated Audit
                </button>
            </div>

            {projectedValue > 0 && (
                <div className="rh-card p-6 rounded-3xl border-2 border-blue-500/50 bg-blue-900/10">
                    <p className="text-xs font-bold text-blue-400 uppercase tracking-wider">Projected Future Value</p>
                    <h2 className="text-6xl font-serif text-white mt-2">{formatCurrency(projectedValue)}</h2>
                </div>
            )}
        </div>
    );
};


// --- 5. DASHBOARD ROOT (The Host) ---
const Dashboard = () => {
  const [equity, setEquity] = useState(5362.43); 
  const [activeTab, setActiveTab] = useState('Crypto'); 
  const [logs, setLogs] = useState([]);
  const [isDeployed, setIsDeployed] = useState(false);
  const [movers, setMovers] = useState(TRENDING); 
  const [news, setNews] = useState(NEWS_MOCK);
  
  const toggleDeploy = () => setIsDeployed(!isDeployed);

  const addLog = useCallback((msg, type) => {
    setLogs(prev => [{time: new Date().toLocaleTimeString(), msg, type}, ...prev.slice(0, 50)]);
  }, []);

  const executeTrade = async (sym, amt, type) => {
    addLog(`SENT: ${type} ${sym} $${amt}`, "TRADE");
    // This is where the Python API call would go
  };

  const currentView = () => {
      switch(activeTab) {
          case 'Crypto':
          case 'Investing':
              return <CryptoView equity={equity} activeTab={activeTab} movers={movers} news={news} />;
          case 'Legacy':
              return <LegacyView equity={equity} addLog={addLog} />;
          default:
              return <div className="text-gray-500 pt-20 text-center">Module {activeTab} Initializing...</div>;
      }
  }

  return (
    <div className="min-h-screen bg-black text-white font-sans pb-20">
      
      {/* NAV BAR */}
      <div className="sticky top-0 z-50 bg-black/90 backdrop-blur border-b border-white/10">
        <div className="max-w-[1200px] mx-auto px-6 h-16 flex justify-between items-center">
          <div className="flex items-center gap-8">
            <span className="text-xl font-bold tracking-tight">Aethel<span className="text-[#00c805]">Bot</span></span>
            <div className="hidden md:flex gap-1">
              {['Investing', 'Crypto', 'Legacy', 'Intel', 'Audit'].map(item => (
                  <NavPill key={item} label={item} activeTab={activeTab} onClick={setActiveTab} />
              ))}
            </div>
          </div>
          <div className="flex items-center gap-4">
            <button onClick={toggleDeploy} className={`px-4 py-1 rounded-full text-xs font-bold ${isDeployed ? 'bg-red-500 text-white' : 'bg-[#00c805] text-black'}`}>
                {isDeployed ? 'DISENGAGE' : 'DEPLOY'}
            </button>
            <div className="w-8 h-8 bg-[#00c805] rounded-full flex items-center justify-center text-black font-bold text-xs">AB</div>
          </div>
        </div>
      </div>

      {/* MAIN LAYOUT */}
      <div className="max-w-[1200px] mx-auto px-6 py-8 grid grid-cols-1 lg:grid-cols-12 gap-16">
        
        {/* LEFT COLUMN (Page View) */}
        <div className="lg:col-span-8">
            {currentView()}
        </div>

        {/* RIGHT COLUMN (The Rail - Trade Context) */}
        <div className="lg:col-span-4 space-y-8">
          <div className="sticky top-24 space-y-6">
            
            <TradeTicket executeTrade={executeTrade} />

            <div className="rh-card rounded-3xl p-5 border border-[#2f3336]">
                <div className="flex items-center gap-2 mb-3"><Terminal size={14} className="text-[#00c805]" /><span className="text-xs font-bold text-gray-400 uppercase">System Log</span></div>
                <div className="font-mono text-[10px] space-y-2 h-40 overflow-y-auto no-scrollbar">
                    {logs.map((l, i) => (
                        <div key={i} className="flex gap-2">
                            <span className="text-gray-600">{l.time}</span>
                            <span className={l.type === 'TRADE' ? 'text-[#00c805]' : 'text-white'}>{l.msg}</span>
                        </div>
                    ))}
                    {logs.length === 0 && <span className="text-gray-600">Waiting for commands...</span>}
                </div>
            </div>

            <div className="bg-[#1f2123] rounded-3xl overflow-hidden border border-[#2f3336]">
              <div className="p-4 border-b border-[#2f3336] flex justify-between items-center"><h3 className="font-bold text-gray-200">Holdings</h3></div>
              {HOLDINGS.map((pos, i) => (
                  <div key={i} className="p-4 hover:bg-white/5 cursor-pointer flex justify-between items-center border-b border-white/5">
                      <div><div className="font-bold text-sm">{pos.sym}</div><div className="text-xs text-gray-500">{pos.qty} units</div></div>
                      <div className="text-right"><div className="font-mono text-sm font-bold">${pos.price}</div></div>
                  </div>
              ))}
            </div>

          </div>
        </div>

      </div>
    </div>
  );
};

// --- ROOT CONTROLLER (Safest Render Path) ---
export default function Root() {
  const [entered, setEntered] = useState(false);
  
  // This simple conditional bypasses complex Framer Motion transitions at the root 
  // that were likely causing the crash on the iPad/Codespaces environment.
  if (!entered) {
    return <LandingPage onEnter={() => setEntered(true)} />;
  }

  // The Dashboard renders without external animation dependencies causing errors.
  return <Dashboard />;
}

==================================================
FILE PATH: ./frontend/src/App.css
==================================================



==================================================
FILE PATH: ./frontend/src/index.css
==================================================

@import url('https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,300;400;500;600&family=Manrope:wght@300;400;600;800&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  color-scheme: dark;
  --rh-green: #00c805; /* The Official Robinhood Neon */
  --rh-black: #000000;
  --rh-dark-gray: #1f2123;
  --rh-hover: #2f3336;
}

body {
  background-color: var(--rh-black);
  color: #ffffff;
  font-family: 'Manrope', sans-serif;
  -webkit-font-smoothing: antialiased;
  overflow-x: hidden;
}

/* --- THE "LEGEND" TYPOGRAPHY --- */
.font-legend {
  font-family: 'Fraunces', serif;
  font-variation-settings: "SOFT" 50, "WONK" 0;
  letter-spacing: -0.04em; /* Tight, editorial tracking */
}

/* --- GLASSMORPHISM UTILITIES --- */
.glass-panel {
  background: rgba(31, 33, 35, 0.7);
  backdrop-filter: blur(16px);
  border: 1px solid rgba(255, 255, 255, 0.08);
}

.rh-input {
  background: #1f2123;
  border: 1px solid transparent;
  transition: all 0.2s ease;
}
.rh-input:focus {
  border-color: var(--rh-green);
  box-shadow: 0 0 0 2px rgba(0, 200, 5, 0.2);
}

/* --- ANIMATIONS --- */
@keyframes pulse-green {
  0%, 100% { box-shadow: 0 0 10px rgba(0, 200, 5, 0.2); }
  50% { box-shadow: 0 0 20px rgba(0, 200, 5, 0.6); }
}

.animate-pulse-green {
  animation: pulse-green 2s infinite;
}

/* Hide Scrollbar but allow scrolling */
.no-scrollbar::-webkit-scrollbar {
  display: none;
}
.no-scrollbar {
  -ms-overflow-style: none;
  scrollbar-width: none;
}

==================================================
FILE PATH: ./frontend/src/main.jsx
==================================================

import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.jsx'

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <App />
  </StrictMode>,
)


==================================================
FILE PATH: ./frontend/src/components/MarketIntel.jsx
==================================================

import React from 'react';

const IntelCard = ({ title, source, sentiment, summary, time }) => (
  <div style={{ padding: '15px', borderBottom: '1px solid #2f3336' }}>
    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '5px' }}>
      <span style={{ fontSize: '0.75rem', color: '#888', textTransform: 'uppercase' }}>{source} ‚Ä¢ {time}</span>
      <span className={`badge ${sentiment === 'BULLISH' ? 'badge-live' : 'badge-closed'}`}>{sentiment}</span>
    </div>
    <h4 style={{ margin: '0 0 5px 0', color: '#fff' }}>{title}</h4>
    <p style={{ margin: '0', fontSize: '0.85rem', color: '#b0b3b8' }}>{summary}</p>
  </div>
);

const MarketIntel = () => {
  return (
    <div className="card" style={{ padding: '0', height: '100%' }}>
      <div style={{ padding: '15px', borderBottom: '1px solid #2f3336', background: '#1e2124' }}>
        <h3>üåê Global Intelligence & Capitol Trades</h3>
      </div>
      
      <div style={{ maxHeight: '450px', overflowY: 'auto' }}>
        {/* MOCK DATA: This will eventually pull from our Python Backend News Scraper */}
        <IntelCard 
          title="Pelosi Tracker: NVDA Call Options"
          source="CAPITOL TRADES"
          sentiment="BULLISH"
          time="2H AGO"
          summary="House Speaker disclosures reveal large purchase of NVIDIA call options. Historical correlation suggests tech sector rally."
        />
        <IntelCard 
          title="Energy Sector: Middle East Supply Chain"
          source="GEOPOLITICS"
          sentiment="BEARISH"
          time="4H AGO"
          summary="Strait of Hormuz tensions increasing. Oil futures (CL=F) showing volatility. Recommend tightening stop-losses on airlines."
        />
        <IntelCard 
          title="Fed Meeting Minutes Leaked"
          source="MACRO ECON"
          sentiment="NEUTRAL"
          time="6H AGO"
          summary="Internal memos suggest rate cuts may be delayed until Q4. Bond yields (US10Y) spiking."
        />
      </div>
    </div>
  );
};

export default MarketIntel;

==================================================
FILE PATH: ./frontend/src/components/TradeHistory.jsx
==================================================

import React, { useState, useEffect } from 'react';

const TradeHistory = () => {
  const [trades, setTrades] = useState([]);
  const [error, setError] = useState(null);

  const fetchHistory = async () => {
    try {
      // RELATIVE PATH - Uses vite.config.js proxy
      const res = await fetch('/api/history');
      const json = await res.json();
      if (json.status === "success") {
        setTrades(json.data);
        setError(null);
      }
    } catch (err) {
      console.error("History Fetch Error:", err);
      setError("Backend Link Failed");
    }
  };

  useEffect(() => {
    fetchHistory();
    const interval = setInterval(fetchHistory, 3000); // Poll every 3s for faster updates
    return () => clearInterval(interval);
  }, []);

  return (
    <div className="bg-[#111] border border-[#2f3336] rounded-lg shadow-lg overflow-hidden">
      <div className="padding-20 border-b border-[#2f3336] p-5 flex justify-between">
        <h3 className="text-xs font-bold text-gray-500 uppercase tracking-wider">Order History</h3>
        {error && <span className="text-red-500 text-xs">{error}</span>}
      </div>
      
      <div className="overflow-x-auto">
        <table className="w-full text-sm text-left text-gray-400">
          <thead className="text-xs text-gray-500 uppercase bg-[#1a1a1a]">
            <tr>
              <th className="px-6 py-3">Time</th>
              <th className="px-6 py-3">Symbol</th>
              <th className="px-6 py-3">Side</th>
              <th className="px-6 py-3">Price</th>
              <th className="px-6 py-3">Status</th>
            </tr>
          </thead>
          <tbody>
            {trades.map((t, index) => (
              <tr key={index} className="border-b border-[#222] hover:bg-[#1a1a1a]">
                <td className="px-6 py-4 font-mono text-xs">
                  {new Date(t.timestamp).toLocaleTimeString()}
                </td>
                <td className="px-6 py-4 font-bold text-white">{t.symbol}</td>
                <td className={`px-6 py-4 font-bold ${t.side === 'BUY' ? 'text-[#00c805]' : 'text-[#ff5000]'}`}>
                  {t.side}
                </td>
                <td className="px-6 py-4 text-white">${t.entry_price}</td>
                <td className="px-6 py-4">
                  <span className="px-2 py-1 rounded bg-blue-900/30 text-blue-400 text-xs border border-blue-800">
                    {t.status || 'FILLED'}
                  </span>
                </td>
              </tr>
            ))}
            {trades.length === 0 && (
               <tr>
                 <td colSpan="5" className="px-6 py-8 text-center text-gray-600 italic">
                    {error ? "Connection Failed. Check Backend." : "No trades yet. System is scanning..."}
                 </td>
               </tr>
            )}
          </tbody>
        </table>
      </div>
    </div>
  );
};

export default TradeHistory;

==================================================
FILE PATH: ./frontend/src/components/Sidebar.jsx
==================================================

import React from 'react';
import { NavLink } from 'react-router-dom';
import { LayoutDashboard, CandlestickChart, Search, Wallet, BookOpen, Settings, FileText, Calculator } from 'lucide-react';

export function Sidebar({ status }) {
  const navItemClass = ({ isActive }) => 
    `p-3 rounded-xl cursor-pointer transition mb-4 flex flex-col items-center gap-1 ${
      isActive ? 'bg-rh-border text-rh-green' : 'text-gray-500 hover:text-white'
    }`;

  return (
    <div className="h-screen border-r border-rh-border bg-rh-card p-4 flex flex-col items-center fixed w-24 z-50 overflow-y-auto no-scrollbar">
      <div className="font-black text-schwab-blue text-2xl mb-10 tracking-tighter">AB</div>
      
      <div className="flex flex-col w-full items-center flex-grow">
        <NavLink to="/" className={navItemClass} title="Dashboard">
          <LayoutDashboard size={24} />
          <span className="text-[10px] font-bold uppercase">Home</span>
        </NavLink>
        
        <NavLink to="/trade" className={navItemClass} title="Trade">
          <CandlestickChart size={24} />
          <span className="text-[10px] font-bold uppercase">Trade</span>
        </NavLink>
        
        <NavLink to="/research" className={navItemClass} title="Research">
          <Search size={24} />
          <span className="text-[10px] font-bold uppercase">Scan</span>
        </NavLink>
        
        <NavLink to="/transfers" className={navItemClass} title="Bank">
          <Wallet size={24} />
          <span className="text-[10px] font-bold uppercase">Bank</span>
        </NavLink>

        {/* NEW MODULES */}
        <NavLink to="/compliance" className={navItemClass} title="Compliance">
          <FileText size={24} />
          <span className="text-[10px] font-bold uppercase">Docs</span>
        </NavLink>

        <NavLink to="/tax" className={navItemClass} title="Tax Engine">
          <Calculator size={24} />
          <span className="text-[10px] font-bold uppercase">Tax</span>
        </NavLink>

        <NavLink to="/learn" className={navItemClass} title="Academy">
          <BookOpen size={24} />
          <span className="text-[10px] font-bold uppercase">Learn</span>
        </NavLink>
      </div>

      <div className="mt-8 flex flex-col gap-4 items-center pb-4">
         <div className="group relative">
           <div className={`w-3 h-3 rounded-full ${status === 'CONNECTED' ? 'bg-rh-green animate-pulse' : 'bg-rh-red'}`} />
         </div>
      </div>
    </div>
  );
}

==================================================
FILE PATH: ./frontend/src/components/MarketChart.jsx
==================================================

import React from 'react';
import { AdvancedRealTimeChart } from 'react-ts-tradingview-widgets';

const MarketChart = ({ symbol }) => {
  return (
    <div className="card" style={{ height: '500px', padding: '0', overflow: 'hidden' }}>
      <AdvancedRealTimeChart 
        symbol={symbol || "NASDAQ:AAPL"} 
        theme="dark" 
        autosize
        interval="D" 
        timezone="America/Los_Angeles" 
        style="1" 
        locale="en" 
        toolbar_bg="#1e2124"
        enable_publishing={false}
        hide_side_toolbar={false}
        allow_symbol_change={true}
        container_id="tradingview_widget"
      />
    </div>
  );
};

export default MarketChart;

==================================================
FILE PATH: ./frontend/src/components/ComplianceCenter.jsx
==================================================

import React from 'react';

const ComplianceCenter = () => {
  return (
    <div className="card" style={{ marginTop: '20px' }}>
      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '15px' }}>
        <h3>‚öñÔ∏è Regulatory & Compliance</h3>
        <button style={{ background: '#333', border: 'none', color: '#fff', padding: '5px 10px', borderRadius: '4px', cursor: 'pointer' }}>
          Generate IRS 8949
        </button>
      </div>

      <div className="grid-top" style={{ gridTemplateColumns: '1fr 1fr 1fr 1fr', gap: '10px' }}>
        <div style={{ background: '#111', padding: '10px', borderRadius: '4px' }}>
          <span className="label">Tax Method</span>
          <div style={{ color: '#fff', fontWeight: 'bold' }}>FIFO (Standard)</div>
        </div>
        <div style={{ background: '#111', padding: '10px', borderRadius: '4px' }}>
          <span className="label">Wash Sales</span>
          <div style={{ color: '#0f0', fontWeight: 'bold' }}>0 DETECTED</div>
        </div>
        <div style={{ background: '#111', padding: '10px', borderRadius: '4px' }}>
          <span className="label">Short Term Cap Gains</span>
          <div style={{ color: '#fff', fontWeight: 'bold' }}>$0.00</div>
        </div>
        <div style={{ background: '#111', padding: '10px', borderRadius: '4px' }}>
          <span className="label">Audit Status</span>
          <div style={{ color: '#0f0', fontWeight: 'bold' }}>COMPLIANT</div>
        </div>
      </div>

      <div style={{ marginTop: '15px', padding: '10px', border: '1px solid #333', borderRadius: '4px', fontSize: '0.8rem', color: '#666' }}>
        <strong>LEGAL DISCLAIMER:</strong> AethelBot v2.0 is an algorithmic execution tool. User (Dave Sarvey) assumes all financial risk. 
        System operates under Pattern Day Trader (PDT) rules if applicable. Logs are immutable for SEC audit purposes.
      </div>
    </div>
  );
};

export default ComplianceCenter;

==================================================
FILE PATH: ./frontend/src/hooks/useWebSocket.js
==================================================

import { useState, useEffect } from 'react';

// HARDCODED LIVE URL
const WS_URL = "wss://didactic-funicular-7v6957wqp9772xw57-8000.app.github.dev/v1/dashboard";

export function useWebSocket() {
  const [socket, setSocket] = useState(null);
  const [status, setStatus] = useState('DISCONNECTED');
  
  // Initialize portfolio with allocations object
  const [portfolio, setPortfolio] = useState({
    equity: 0,
    pnl: 0,
    cash: 0,
    history: [],
    allocations: {} 
  });

  const [marketData, setMarketData] = useState({"CSCO": 0, "NVDA": 0, "SPY": 0, "BTC/USD": 0});
  const [newsFeed, setNewsFeed] = useState([]);
  const [logs, setLogs] = useState([]);

  useEffect(() => {
    const ws = new WebSocket(WS_URL);
    ws.onopen = () => setStatus('CONNECTED');

    ws.onmessage = (event) => {
      try {
        const msg = JSON.parse(event.data);
        
        if (msg.type === 'PORTFOLIO_UPDATE') {
          setPortfolio(prev => ({
            equity: msg.payload.equity,
            pnl: msg.payload.pnl,
            cash: msg.payload.uninvestedCash,
            allocations: msg.payload.allocations || {}, // Capture the shadow positions
            history: [...prev.history, { time: new Date().toLocaleTimeString(), value: msg.payload.equity }].slice(-50)
          }));
          
          if (msg.payload.marketData) setMarketData(msg.payload.marketData);
          if (msg.payload.news) setNewsFeed(msg.payload.news);
        }
        
        if (msg.type === 'LOG_ENTRY') {
          setLogs(prev => [msg.payload, ...prev].slice(0, 50));
        }
      } catch (e) {
        console.error('Parse Error', e);
      }
    };

    ws.onclose = () => setStatus('DISCONNECTED');
    setSocket(ws);
    return () => ws.close();
  }, []);

  return { socket, status, portfolio, logs, marketData, newsFeed };
}

==================================================
FILE PATH: ./frontend/src/pages/TaxPage.jsx
==================================================

import React, { useState } from 'react';
import { Calculator, TrendingDown, DollarSign, CheckCircle } from 'lucide-react';

// LIVE BACKEND URL
const API_URL = "https://didactic-funicular-7v6957wqp9772xw57-8000.app.github.dev/v1";

export function TaxPage({ portfolio }) {
  const [analysis, setAnalysis] = useState(null);
  const [loading, setLoading] = useState(false);

  const handleTaxScan = async () => {
    setLoading(true);
    try {
      // We send the current portfolio state to the backend for analysis
      const res = await fetch(`${API_URL}/compliance/tax_audit`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ positions: portfolio.allocations, pnl: portfolio.pnl })
      });
      const data = await res.json();
      setAnalysis(data);
    } catch (err) {
      alert("Tax Engine Error: " + err.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="max-w-4xl mx-auto animate-fade-in">
      <div className="flex justify-between items-end mb-10">
         <div>
            <h1 className="text-3xl font-light text-white">Tax Optimization Engine</h1>
            <div className="text-sm text-gray-500 mt-1">Real-time liability calculation and loss harvesting</div>
         </div>
         <button 
            onClick={handleTaxScan}
            disabled={loading}
            className="bg-white text-black px-6 py-3 rounded-full font-bold text-sm hover:bg-gray-200 transition flex items-center gap-2"
         >
            {loading ? "ANALYZING..." : <><Calculator size={16} /> RUN TAX AUDIT</>}
         </button>
      </div>

      {!analysis && !loading && (
          <div className="text-center p-20 border border-rh-border border-dashed rounded-xl text-gray-600">
             Initialize the AI Tax Strategist to analyze your current holdings for tax efficiency.
          </div>
      )}

      {analysis && (
        <div className="space-y-6">
            {/* METRICS */}
            <div className="grid grid-cols-3 gap-6">
                <div className="bg-rh-card border border-rh-border rounded-xl p-6">
                    <div className="text-gray-500 text-xs font-bold uppercase mb-1">Est. Tax Liability</div>
                    <div className="text-3xl font-light text-rh-red">{analysis.estimated_tax}</div>
                    <div className="text-xs text-gray-500 mt-2">Short Term Rate (37%)</div>
                </div>
                <div className="bg-rh-card border border-rh-border rounded-xl p-6">
                    <div className="text-gray-500 text-xs font-bold uppercase mb-1">Tax Drag</div>
                    <div className="text-3xl font-light text-white">{analysis.tax_drag}%</div>
                    <div className="text-xs text-gray-500 mt-2">Portfolio Impact</div>
                </div>
                <div className="bg-rh-card border border-rh-border rounded-xl p-6">
                    <div className="text-gray-500 text-xs font-bold uppercase mb-1">Net Profit (Post-Tax)</div>
                    <div className="text-3xl font-light text-rh-green">{analysis.net_profit}</div>
                </div>
            </div>

            {/* AI STRATEGY */}
            <div className="bg-rh-card border border-rh-border rounded-xl p-8">
                <h3 className="text-schwab-blue font-bold mb-4 flex items-center gap-2">
                    <CheckCircle size={18} /> AI STRATEGIST RECOMMENDATION
                </h3>
                <div className="text-gray-300 text-lg leading-relaxed whitespace-pre-wrap">
                    {analysis.strategy}
                </div>
            </div>
        </div>
      )}
    </div>
  );
}

==================================================
FILE PATH: ./frontend/src/pages/Dashboard.jsx
==================================================

import React from 'react';
import { LineChart, Line, ResponsiveContainer, YAxis, Tooltip } from 'recharts';
import { TrendingUp, Play, Power, ShieldAlert, Newspaper, PieChart } from 'lucide-react';

// LIVE BACKEND URL
const API_URL = "https://didactic-funicular-7v6957wqp9772xw57-8000.app.github.dev/v1";

export function Dashboard({ portfolio, logs, marketData, newsFeed, status }) {
  const isPositive = portfolio.pnl >= 0;
  const pnlColor = isPositive ? 'text-rh-green' : 'text-rh-red';

  const handleDeploy = async () => { try { await fetch(`${API_URL}/strategy/deploy`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ initialFunding: 100000, additionalCapital: 0, configuration: {} }) }); } catch (err) { alert("Deploy Error"); } };
  const handleStop = async () => { if (confirm("HALT?")) { try { await fetch(`${API_URL}/strategy/stop`, { method: 'POST' }); window.location.reload(); } catch (err) { alert("Stop Error"); } } };

  return (
    <div className="grid grid-cols-12 gap-8 animate-fade-in">
      {/* CENTER: CHART & METRICS */}
      <div className="col-span-8 space-y-8">
        <div className="flex justify-between items-end">
            <div>
                <div className="text-gray-500 text-xs font-bold tracking-widest mb-1">TOTAL INVESTING</div>
                <h1 className="text-5xl font-light">{new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(portfolio.equity)}</h1>
                <div className={`text-sm font-medium mt-2 ${pnlColor}`}>
                {isPositive ? '+' : ''}{new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(portfolio.pnl)} Today
                </div>
            </div>
            <div className="flex gap-3">
                {portfolio.equity <= 0 ? (
                <button onClick={handleDeploy} className="bg-rh-green text-black px-6 py-2 rounded-full font-bold text-sm hover:scale-105 transition flex items-center gap-2"><Play size={16} /> DEPLOY</button>
                ) : (
                <button onClick={handleStop} className="bg-rh-card border border-rh-border text-rh-red px-6 py-2 rounded-full font-bold text-sm hover:bg-rh-red hover:text-white transition flex items-center gap-2"><Power size={16} /> STOP</button>
                )}
            </div>
        </div>

        <div className="h-80 w-full border-b border-rh-border pb-8">
            <ResponsiveContainer width="100%" height="100%">
            <LineChart data={portfolio.history}>
                <Tooltip contentStyle={{ backgroundColor: '#1e2124', borderColor: '#30363a' }} itemStyle={{ color: '#fff' }} labelStyle={{ display: 'none' }} />
                <Line type="monotone" dataKey="value" stroke={isPositive ? '#00c805' : '#ff5000'} strokeWidth={2} dot={false} />
                <YAxis domain={['auto', 'auto']} hide />
            </LineChart>
            </ResponsiveContainer>
        </div>

        {/* Active Allocations (Positions) */}
        <div className="bg-rh-card border border-rh-border rounded-xl overflow-hidden">
            <div className="p-4 border-b border-rh-border flex items-center gap-2">
                 <PieChart size={16} className="text-schwab-blue"/> 
                 <span className="font-bold text-sm">ACTIVE POSITIONS</span>
            </div>
            <table className="w-full text-left text-sm">
                <thead className="text-gray-500 bg-rh-dark">
                <tr><th className="p-4">Asset</th><th className="p-4 text-right">Price</th><th className="p-4 text-right">Value</th></tr>
                </thead>
                <tbody>
                {(!portfolio.allocations || Object.keys(portfolio.allocations).length === 0) ? (
                    <tr><td colSpan="3" className="p-8 text-center text-gray-600 italic">No active positions.</td></tr>
                ) : (
                    Object.entries(portfolio.allocations).map(([ticker, pos]) => (
                        <tr key={ticker} className="border-b border-rh-border/30 hover:bg-rh-border/20 transition">
                            <td className="p-4 font-bold text-white">{ticker}</td>
                            <td className="p-4 text-right text-gray-300">{new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(pos.current_price)}</td>
                            <td className="p-4 text-right text-white font-mono">{new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(pos.value)}</td>
                        </tr>
                    ))
                )}
                </tbody>
            </table>
        </div>

        {/* Logs */}
        <div className="bg-rh-card border border-rh-border rounded-xl p-5 h-48 flex flex-col">
             <div className="text-gray-500 text-xs font-bold uppercase mb-4 flex items-center gap-2"><ShieldAlert size={14} /> Live Feed</div>
             <div className="overflow-y-auto space-y-3 font-mono text-xs flex-1 pr-2">
               {logs.map((log, i) => (
                 <div key={i} className="border-b border-rh-border/50 pb-2 last:border-0 flex gap-3">
                   <span className="text-gray-500">[{log.timestamp.split('T')[1].split('.')[0]}]</span> <span className="text-gray-300">{log.message}</span>
                 </div>
               ))}
             </div>
        </div>
      </div>

      {/* RIGHT: LISTS & NEWS */}
      <div className="col-span-4 space-y-8">
         <div className="bg-rh-card border border-rh-border rounded-xl p-6">
            <h2 className="text-gray-500 font-bold mb-4 text-xs uppercase tracking-wider">Watchlist</h2>
            {Object.entries(marketData).map(([ticker, price]) => (
                <div key={ticker} className="flex justify-between items-center py-3 border-b border-rh-border/30 last:border-0">
                  <div className="font-bold">{ticker}</div>
                  <div className="font-mono text-white">{price > 0 ? new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(price) : '--'}</div>
                </div>
            ))}
         </div>

         <div className="bg-rh-card border border-rh-border rounded-xl p-6">
            <h2 className="text-gray-500 font-bold mb-4 text-xs uppercase tracking-wider flex items-center gap-2"><Newspaper size={14} /> Market News</h2>
            <div className="space-y-4">
             {newsFeed.length === 0 ? <div className="text-xs text-gray-500 italic">Streaming news...</div> : 
               newsFeed.map((news, i) => (
                 <div key={i} className="text-sm hover:text-rh-green cursor-pointer transition border-b border-rh-border/30 pb-3 last:border-0">
                    <div className="font-bold mb-1 line-clamp-2">{news.headline}</div>
                 </div>
               ))
             }
           </div>
         </div>
      </div>
    </div>
  );
}

==================================================
FILE PATH: ./frontend/src/pages/ResearchPage.jsx
==================================================

import React, { useState } from 'react';
import { Search, TrendingUp, AlertTriangle } from 'lucide-react';

const API_URL = "https://didactic-funicular-7v6957wqp9772xw57-8000.app.github.dev/v1";

export function ResearchPage() {
  const [results, setResults] = useState([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  const handleScan = async () => {
    setLoading(true);
    setError(null);
    try {
      const res = await fetch(`${API_URL}/research/scan_market`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({}) // Empty body for general scan
      });
      const data = await res.json();
      
      if (data.error) throw new Error(data.error);
      
      const headlines = data.results.split('\n').filter(line => line.trim() !== '');
      setResults(headlines);
    } catch (err) {
      setError("Market Scan Failed. Check backend terminal for API key errors.");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="max-w-4xl mx-auto mt-10 animate-fade-in">
      <div className="flex justify-between items-end mb-10">
         <div>
            <h1 className="text-3xl font-light text-white">AI Market Scanner</h1>
            <p className="text-gray-500 text-sm mt-1">Proactively hunts for high-volatility, high-alpha opportunities.</p>
         </div>
         <button 
            onClick={handleScan}
            disabled={loading}
            className="bg-rh-green text-black px-6 py-3 rounded-full font-bold text-sm hover:scale-105 transition flex items-center gap-2"
         >
            {loading ? "SCANNING..." : <><TrendingUp size={16} /> RUN FULL MARKET SCAN</>}
         </button>
      </div>

      <div className="bg-rh-card border border-rh-border rounded-xl p-6 min-h-[400px]">
        {error && <div className="text-rh-red font-mono text-sm p-4">{error}</div>}

        {results.length === 0 && !loading && !error && (
            <div className="text-center p-20 text-gray-600">
                <Search size={48} className="mb-4 opacity-50" />
                <p>Click RUN FULL MARKET SCAN to find active momentum plays.</p>
            </div>
        )}
        
        {results.map((headline, i) => (
            <div key={i} className="py-3 border-b border-rh-border/30 last:border-0 text-gray-300 flex items-start gap-3">
                <div className="mt-1"><AlertTriangle size={14} className="text-rh-red" /></div>
                <div className="text-sm">
                    {headline.includes("VOLATILITY") ? <span className="text-rh-red font-bold">{headline}</span> : headline}
                </div>
            </div>
        ))}
      </div>
    </div>
  );
}

==================================================
FILE PATH: ./frontend/src/pages/TransfersPage.jsx
==================================================

import React, { useState } from 'react';
import { Wallet, ArrowRight, TrendingUp, ShieldCheck } from 'lucide-react';

// LIVE BACKEND URL
const API_URL = "https://didactic-funicular-7v6957wqp9772xw57-8000.app.github.dev/v1";

export function TransfersPage() {
  const [amount, setAmount] = useState('');
  const [loading, setLoading] = useState(false);
  const [status, setStatus] = useState(null); // null, 'success', 'error'

  const handleDeposit = async () => {
    const val = parseFloat(amount);
    if (!val || val <= 0) return;

    setLoading(true);
    try {
      const res = await fetch(`${API_URL}/capital/inject`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ amount: val })
      });
      if (!res.ok) throw new Error("Transfer failed");
      
      setStatus('success');
      setAmount('');
      setTimeout(() => setStatus(null), 3000); // Reset after 3s
    } catch (err) {
      alert(err.message);
      setStatus('error');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="max-w-2xl mx-auto mt-10 animate-fade-in">
      <div className="bg-rh-card border border-rh-border rounded-2xl p-8 shadow-lg">
        
        <div className="flex items-center gap-4 mb-8 border-b border-rh-border pb-6">
          <div className="p-3 bg-rh-dark rounded-full text-rh-green">
            <Wallet size={32} />
          </div>
          <div>
            <h1 className="text-2xl font-light text-white">Instant Deposit</h1>
            <p className="text-gray-500 text-sm">Capital is immediately deployed by the Auto-Pilot Engine.</p>
          </div>
        </div>

        <div className="space-y-6">
          <div>
            <label className="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2">Amount</label>
            <div className="relative">
              <span className="absolute left-4 top-1/2 -translate-y-1/2 text-2xl text-gray-400">$</span>
              <input 
                type="number" 
                value={amount}
                onChange={(e) => setAmount(e.target.value)}
                placeholder="0.00"
                className="w-full bg-rh-dark border border-rh-border rounded-xl py-4 pl-10 pr-4 text-3xl text-white focus:border-rh-green outline-none transition font-mono"
              />
            </div>
          </div>

          {/* AI Insight Box */}
          <div className="bg-rh-dark/50 p-4 rounded-lg border border-rh-border flex gap-3">
             <TrendingUp className="text-schwab-blue shrink-0" size={20} />
             <div className="text-sm text-gray-300">
               <span className="font-bold text-schwab-blue">AI Strategy:</span> Upon deposit, AethelBot will run a <span className="font-mono text-xs bg-gray-700 px-1 rounded">scan_market_momentum</span> check and allocate this capital to the highest velocity assets found in the last 60s.
             </div>
          </div>

          <button 
            onClick={handleDeposit}
            disabled={loading}
            className={`w-full py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 transition ${
              status === 'success' 
                ? 'bg-rh-green text-black' 
                : 'bg-white text-black hover:bg-gray-200'
            }`}
          >
            {loading ? (
              <span className="animate-pulse">Processing...</span>
            ) : status === 'success' ? (
              <>Deposit Complete <ShieldCheck size={20} /></>
            ) : (
              <>Review & Deposit <ArrowRight size={20} /></>
            )}
          </button>
        </div>
      </div>
    </div>
  );
}

==================================================
FILE PATH: ./frontend/src/pages/CompliancePage.jsx
==================================================

import React from 'react';
import { FileText, ShieldCheck, AlertTriangle, Download } from 'lucide-react';

export function CompliancePage() {
  return (
    <div className="space-y-8 animate-fade-in">
      <div className="flex justify-between items-center">
         <div>
            <h1 className="text-3xl font-light text-white">Compliance & Records</h1>
            <div className="text-sm text-gray-500 mt-1">Regulatory documents and account alerts</div>
         </div>
         <div className="bg-rh-card border border-rh-border px-4 py-2 rounded-full text-rh-green flex items-center gap-2 text-sm font-bold">
            <ShieldCheck size={16} /> ACCOUNT IN GOOD STANDING
         </div>
      </div>

      <div className="grid grid-cols-2 gap-8">
        {/* ALERTS */}
        <div className="bg-rh-card border border-rh-border rounded-xl p-6">
           <h2 className="text-gray-500 font-bold mb-6 text-xs uppercase tracking-wider flex items-center gap-2">
              <AlertTriangle size={14} /> Active Restrictions
           </h2>
           <div className="space-y-4">
              <div className="bg-rh-dark p-4 rounded-lg border border-rh-border flex justify-between items-center">
                 <div>
                    <div className="font-bold text-white">Pattern Day Trader (PDT)</div>
                    <div className="text-xs text-gray-400">Equity must remain above $25k for unlimited day trades.</div>
                 </div>
                 <span className="text-rh-green font-mono text-xs">UNLIMITED</span>
              </div>
              <div className="bg-rh-dark p-4 rounded-lg border border-rh-border flex justify-between items-center">
                 <div>
                    <div className="font-bold text-white">Wash Sale Watch</div>
                    <div className="text-xs text-gray-400">Monitoring 30-day repurchase windows on NVDA.</div>
                 </div>
                 <span className="text-schwab-blue font-mono text-xs">ACTIVE</span>
              </div>
           </div>
        </div>

        {/* DOCUMENTS */}
        <div className="bg-rh-card border border-rh-border rounded-xl p-6">
           <h2 className="text-gray-500 font-bold mb-6 text-xs uppercase tracking-wider flex items-center gap-2">
              <FileText size={14} /> Documents
           </h2>
           <div className="space-y-2">
              {[
                  { name: "Trade Confirmation (Nov 18)", type: "PDF" },
                  { name: "Monthly Statement (Oct 2025)", type: "PDF" },
                  { name: "Form 1099-B (2024)", type: "TAX" },
                  { name: "Risk Disclosure Agreement", type: "LEGAL" }
              ].map((doc, i) => (
                 <div key={i} className="flex justify-between items-center p-3 hover:bg-rh-border/30 rounded-lg cursor-pointer transition group">
                    <div className="flex items-center gap-3">
                       <div className="bg-rh-dark p-2 rounded text-xs font-bold text-gray-400">{doc.type}</div>
                       <span className="text-sm text-gray-300 group-hover:text-white">{doc.name}</span>
                    </div>
                    <Download size={16} className="text-gray-500 group-hover:text-white" />
                 </div>
              ))}
           </div>
        </div>
      </div>
    </div>
  );
}

==================================================
FILE PATH: ./frontend/src/pages/TradePage.jsx
==================================================

import React, { useState } from 'react';
import { CandlestickChart, AlertTriangle, CheckCircle, Search, DollarSign } from 'lucide-react';

const API_URL = "https://didactic-funicular-7v6957wqp9772xw57-8000.app.github.dev/v1";

export function TradePage() {
  const [ticker, setTicker] = useState('');
  const [qty, setQty] = useState('');
  const [side, setSide] = useState('buy'); // 'buy' or 'sell'
  const [aiOpinion, setAiOpinion] = useState(null);
  const [analyzing, setAnalyzing] = useState(false);

  // 1. Ask AI for an Audit
  const handleAudit = async () => {
    if (!ticker) return;
    setAnalyzing(true);
    setAiOpinion(null);
    try {
      const res = await fetch(`${API_URL}/research/tso`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ ticker: ticker })
      });
      const data = await res.json();
      
      // CRITICAL FIX: Ensure data.summary is a string before calling includes()
      const summaryText = typeof data.summary === 'string' ? data.summary : (data.summary ? JSON.stringify(data.summary) : "Analysis failed to produce string output.");
      
      // Secondary fix for the UI: Ensure we have a string to parse
      const parsedText = summaryText.toUpperCase();

      const isBullish = parsedText.includes("SIGNAL: BUY");
      const isBearish = parsedText.includes("SIGNAL: SELL");
      
      const agrees = (side === 'buy' && isBullish) || (side === 'sell' && isBearish);
      
      setAiOpinion({
        text: summaryText,
        agrees: agrees,
        signal: isBullish ? 'BUY' : isBearish ? 'SELL' : 'HOLD'
      });
    } catch (err) {
      alert("Audit Error: " + err.message);
    } finally {
      setAnalyzing(false);
    }
  };

  const handleSubmit = () => {
    alert(`Order Sent to Paper Broker: ${side.toUpperCase()} ${qty} ${ticker}`);
    // Phase 4.2: Wire this to a real endpoint
  };

  return (
    <div className="max-w-5xl mx-auto grid grid-cols-12 gap-8 animate-fade-in">
      
      {/* LEFT: The Ticket */}
      <div className="col-span-5">
        <div className="bg-rh-card border border-rh-border rounded-2xl p-6 shadow-lg sticky top-6">
           <h2 className="text-xl font-light mb-6 flex items-center gap-2">
             <CandlestickChart className="text-rh-green" /> Smart Order Ticket
           </h2>

           <div className="space-y-4">
             {/* Side Selection */}
             <div className="grid grid-cols-2 gap-2">
               <button 
                 onClick={() => setSide('buy')}
                 className={`py-2 rounded-lg font-bold text-sm transition ${side === 'buy' ? 'bg-rh-green text-black' : 'bg-rh-dark border border-rh-border text-gray-500'}`}
               >
                 BUY
               </button>
               <button 
                 onClick={() => setSide('sell')}
                 className={`py-2 rounded-lg font-bold text-sm transition ${side === 'sell' ? 'bg-rh-red text-white' : 'bg-rh-dark border border-rh-border text-gray-500'}`}
               >
                 SELL
               </button>
             </div>

             {/* Ticker & Qty Input */}
             <div>
               <label className="text-xs font-bold text-gray-500">SYMBOL</label>
               <input 
                 value={ticker}
                 onChange={(e) => setTicker(e.target.value.toUpperCase())}
                 className="w-full bg-rh-dark border border-rh-border rounded-lg p-3 text-white font-mono focus:border-rh-green outline-none"
                 placeholder="e.g. NVDA"
               />
             </div>
             <div>
               <label className="text-xs font-bold text-gray-500">SHARES</label>
               <input 
                 type="number"
                 value={qty}
                 onChange={(e) => setQty(e.target.value)}
                 className="w-full bg-rh-dark border border-rh-border rounded-lg p-3 text-white font-mono focus:border-rh-green outline-none"
                 placeholder="100"
               />
             </div>

             {/* AI Audit Trigger */}
             <button 
               onClick={handleAudit}
               disabled={analyzing || !ticker}
               className="w-full py-3 mt-4 border border-schwab-blue text-schwab-blue rounded-lg font-bold hover:bg-schwab-blue/10 transition flex justify-center items-center gap-2"
             >
               {analyzing ? "ANALYZING..." : <><Search size={16}/> Run AI Risk Audit</>}
             </button>

             {/* Execute */}
             <button 
               onClick={handleSubmit}
               disabled={!aiOpinion} // Force Audit first
               className={`w-full py-4 rounded-xl font-bold text-lg mt-2 transition ${
                 !aiOpinion ? 'bg-gray-700 text-gray-500 cursor-not-allowed' : 'bg-white text-black hover:opacity-90'
               }`}
             >
               SUBMIT ORDER
             </button>

           </div>
        </div>
        <div className="mt-8 bg-rh-card border border-rh-border rounded-2xl p-6">
            <h2 className="text-sm font-bold text-gray-500 uppercase mb-2">Current Cash / Exposure</h2>
            <div className="flex justify-between items-center text-xl font-mono">
                <span>Cash: <DollarSign size={20} className="inline"/> 10,000.00</span>
                <span>Max Exposure: <DollarSign size={20} className="inline"/> 20,000.00</span>
            </div>
        </div>
      </div>

      {/* RIGHT: The Brain */}
      <div className="col-span-7">
        {!aiOpinion ? (
          <div className="h-full border-2 border-dashed border-rh-border rounded-2xl flex flex-col items-center justify-center text-gray-500 p-10 text-center">
            <Search size={48} className="mb-4 opacity-50" />
            <h3 className="text-lg font-bold">AI Audit Required</h3>
            <p className="text-sm mt-2 max-w-xs">Enter a ticker and click "Run AI Risk Audit" to check technicals, sentiment, and insider moves before trading.</p>
          </div>
        ) : (
          <div className={`rounded-2xl p-6 border ${aiOpinion.agrees ? 'bg-rh-green/10 border-rh-green' : 'bg-rh-red/10 border-rh-red'}`}>
             <div className="flex items-center gap-3 mb-4">
               {aiOpinion.agrees ? <CheckCircle className="text-rh-green" size={28}/> : <AlertTriangle className="text-rh-red" size={28}/>}
               <h3 className="text-xl font-bold text-white">
                 {aiOpinion.agrees ? `Trade Approved (${aiOpinion.signal})` : "High Risk Warning"}
               </h3>
             </div>
             
             <div className="bg-rh-card p-6 rounded-xl border border-rh-border text-gray-300 leading-relaxed whitespace-pre-wrap">
               {aiOpinion.text}
             </div>
             
             {!aiOpinion.agrees && (
               <div className="mt-4 text-rh-red text-xs font-bold uppercase tracking-widest">
                 The AI advises against this trade based on current data.
               </div>
             )}
          </div>
        )}
      </div>

    </div>
  );
}

==================================================
FILE PATH: ./.devcontainer/devcontainer.json
==================================================

{
  "name": "AethelBot Container (V-ENV BUILT)",
  "image": "mcr.microsoft.com/devcontainers/python:3.12-bookworm",
  "postCreateCommand": "python3 -m venv venv && ./venv/bin/pip install --upgrade pip && ./venv/bin/pip install -r requirements.txt"
}

==================================================
FILE PATH: ./backend/routes.py
==================================================

from fastapi import APIRouter, WebSocket, WebSocketDisconnect
from schemas import TradeSignal
from agent import get_market_analysis
from database import log_trade, get_position, close_position, get_trade_history
import asyncio
import json
import logging

# Setup logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger("AethelRoutes")

router = APIRouter()

# --- CONNECTION MANAGER ---
class ConnectionManager:
    def __init__(self):
        self.active_connections: list[WebSocket] = []

    async def connect(self, websocket: WebSocket):
        await websocket.accept()
        self.active_connections.append(websocket)
        logger.info(f"WebSocket Client Connected. Total: {len(self.active_connections)}")

    def disconnect(self, websocket: WebSocket):
        if websocket in self.active_connections:
            self.active_connections.remove(websocket)
            logger.info("WebSocket Client Disconnected")

    async def broadcast(self, message: str):
        for connection in self.active_connections:
            try:
                await connection.send_text(message)
            except Exception as e:
                logger.error(f"Broadcast Error: {e}")
                # Optionally remove dead connection here

manager = ConnectionManager()

# --- ENDPOINTS ---

@router.post("/trade-hook")
async def trade_hook(signal: TradeSignal):
    """
    Manual/External Trade Trigger.
    """
    logger.info(f"üöÄ Signal Received: {signal.symbol} | {signal.action}")
    
    # 1. Analysis
    ai_decision = get_market_analysis(signal.symbol)
    
    # 2. Broadcast Thoughts
    await manager.broadcast(json.dumps({
        "type": "AI_ANALYSIS",
        "data": ai_decision
    }))

    # 3. Execution
    if ai_decision["decision"] == "BUY":
        log_trade(signal.symbol, "BUY", 1.0, signal.price, "MANUAL-OVERRIDE")
        await manager.broadcast(json.dumps({
            "type": "TRADE_EXECUTION",
            "data": {"symbol": signal.symbol, "side": "BUY", "fill_price": signal.price}
        }))

    return {"status": "processed", "ai_response": ai_decision}

@router.websocket("/ws")
async def websocket_endpoint(websocket: WebSocket):
    await manager.connect(websocket)
    try:
        while True:
            # Keep the connection alive and listening
            # If the client sends data, we just log it for now
            data = await websocket.receive_text()
            # logger.info(f"Client sent: {data}") 
    except WebSocketDisconnect:
        manager.disconnect(websocket)
    except Exception as e:
        logger.error(f"WebSocket Error: {e}")
        manager.disconnect(websocket)

@router.get("/history")
async def history_endpoint():
    """
    Returns recent trades for the frontend table.
    """
    try:
        data = get_trade_history(limit=50)
        return {"status": "success", "data": data}
    except Exception as e:
        logger.error(f"History Fetch Error: {e}")
        return {"status": "error", "message": str(e)}

==================================================
FILE PATH: ./backend/state.py
==================================================

# state.py
# REFACTORED: Zero-Based Accounting + Shadow Portfolio

from fastapi import WebSocket
from typing import List, Dict, Any

class ConnectionManager:
    def __init__(self):
        self.active_connections: List[WebSocket] = []

    async def connect(self, websocket: WebSocket):
        await websocket.accept()
        self.active_connections.append(websocket)

    def disconnect(self, websocket: WebSocket):
        self.active_connections.remove(websocket)

    async def broadcast_json(self, message: dict):
        for connection in self.active_connections:
            try:
                await connection.send_json(message)
            except:
                pass

manager = ConnectionManager()

# GLOBAL STATE
bot_state: Dict[str, Any] = {
    "is_deployed": False,
    "bot_task": None,
    
    # Financials
    "equity": 0.0,                  # Total Value (Cash + Holdings)
    "pnl": 0.0,                     # Profit/Loss
    "total_external_funding": 0.0,  # Total Cash Deposited
    "uninvested_cash": 0.0,         # Cash on hand
    
    # The Shadow Portfolio
    # Format: {'NVDA': {'qty': 10.5, 'entry_price': 140.00, 'current_price': 142.00}}
    "positions": {},
    
    # Live Data Cache
    "market_data": {} 
}

==================================================
FILE PATH: ./backend/config.py
==================================================

import os
from dotenv import load_dotenv

# Load .env file
load_dotenv()

# --- API KEYS (CORRECT: Fetch by Variable NAME) ---
OPENROUTER_API_KEY = os.getenv("OPENROUTER_API_KEY")
GOOGLE_API_KEY = os.getenv("GOOGLE_API_KEY")
GROQ_API_KEY = os.getenv("GROQ_API_KEY")
HUGGINGFACEHUB_API_TOKEN = os.getenv("HUGGINGFACEHUB_API_TOKEN")

# --- Market Data ---
ALPACA_API_KEY = os.getenv("ALPACA_API_KEY")
ALPACA_API_SECRET = os.getenv("ALPACA_API_SECRET")
FINNHUB_API_KEY = os.getenv("FINNHUB_API_KEY")

# --- Configuration Object ---
ALPACA_CONFIG = {
    "key_id": ALPACA_API_KEY,
    "secret_key": ALPACA_API_SECRET,
    "paper": True
}

==================================================
FILE PATH: ./backend/requirements.txt
==================================================

fastapi==0.109.0
uvicorn==0.27.0
python-dotenv==1.0.1
requests==2.31.0
# ALPACA COMPATIBILITY
websockets==10.4
alpaca-trade-api==3.2.0
finnhub-python==2.4.19
# HYDRA BRAIN (Version Harmonized)
langchain==0.1.16
langchain-community==0.0.32
langchain-core==0.1.45
langchain-groq==0.1.3
langchain-google-genai==1.0.3
langchain-openai==0.1.3
# DATA LAYERS
pydantic==2.6.1
numpy==1.26.4
pandas==2.2.1

==================================================
FILE PATH: ./backend/schemas.py
==================================================

# [FILE: backend/schemas.py]
from pydantic import BaseModel

class TradeSignal(BaseModel):
    """
    Defines the structure of an incoming trade signal 
    (e.g. from TradingView webhook or manual input).
    """
    symbol: str
    action: str   # Expecting "BUY" or "SELL"
    price: float

==================================================
FILE PATH: ./backend/utils.py
==================================================

# utils.py
# Contains reusable logic that doesn't belong in the agent or the router.

import asyncio
import config
from datetime import datetime
from alpaca.data.historical import StockHistoricalDataClient, CryptoHistoricalDataClient
from alpaca.data.requests import StockLatestQuoteRequest, CryptoLatestQuoteRequest

# --- Clients ---
try:
    stock_client = StockHistoricalDataClient(config.ALPACA_API_KEY, config.ALPACA_API_SECRET)
    crypto_client = CryptoHistoricalDataClient(config.ALPACA_API_KEY, config.ALPACA_API_SECRET)
except Exception as e:
    print(f"Warning: Alpaca Data Clients failed to initialize in utils.py: {e}")
    stock_client = None
    crypto_client = None

# --- Watchlist ---
STOCKS = ["NVDA", "TSLA", "AAPL", "MSFT", "AMZN", "GOOGL", "META", "AMD", "INTC", "COIN", "PLTR", "SPY", "QQQ", "IWM", "TLT", "MSTR", "GME", "HOOD"]
CRYPTO = ["BTC/USD", "ETH/USD", "SOL/USD", "DOGE/USD", "SHIB/USD"]


def fetch_live_prices():
    """Fetches prices for Watchlist AND Active Positions (Synchronous)."""
    from state import bot_state # Lazy import state to avoid circular dependency
    prices = {}
    try:
        active_stocks = [s for s in bot_state['positions'].keys() if '/' not in s]
        all_stocks = list(set(STOCKS + active_stocks))
        req = StockLatestQuoteRequest(symbol_or_symbols=all_stocks[:20]) 
        res = stock_client.get_stock_latest_quote(req)
        for sym, quote in res.items(): prices[sym] = quote.ask_price
    except Exception as e: print(f"Stock Data Error: {e}")

    try:
        active_crypto = [c for c in bot_state['positions'].keys() if '/' in c]
        all_crypto = list(set(CRYPTO + active_crypto))
        req = CryptoLatestQuoteRequest(symbol_or_symbols=all_crypto)
        res = crypto_client.get_crypto_latest_quote(req)
        for sym, quote in res.items(): prices[sym] = quote.ask_price
    except Exception as e: print(f"Crypto Data Error: {e}")
    return prices
    
def scan_market_momentum(finnhub_client):
    """
    Core logic for scanning high-volatility news. Used by both agent and endpoint.
    """
    if not finnhub_client: return "Data unavailable"
    try:
        news = finnhub_client.general_news('general', min_id=0)[:20]
        hot_keywords = ['surge', 'soar', 'jump', 'breakout', 'rally', 'record', 'crash', 'plunge', 'volatile', 'squeeze']
        hot_news = []
        for n in news:
            headline = n['headline']
            if any(k in headline.lower() for k in hot_keywords):
                hot_news.append(headline)
        
        if not hot_news:
            return "No extreme volatility detected. Top headlines: " + " | ".join([n['headline'] for n in news[:5]])
            
        return "VOLATILITY ALERTS:\n" + "\n".join(hot_news)
    except Exception as e: return f"Scan failed: {e}"

# --- End of utils.py ---

==================================================
FILE PATH: ./backend/main.py
==================================================

from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from contextlib import asynccontextmanager
import asyncio

from database import init_db
from routes import router as api_router
from loop import trading_heartbeat

# Lifespan Manager (The modern way to handle startup/shutdown in FastAPI)
@asynccontextmanager
async def lifespan(app: FastAPI):
    # [STARTUP]
    init_db()
    print("[SYSTEM] Database Connected.")
    
    # Start the Trading Heartbeat in the background
    loop_task = asyncio.create_task(trading_heartbeat())
    
    yield
    
    # [SHUTDOWN]
    loop_task.cancel()
    print("[SYSTEM] Trading Loop Terminated.")

app = FastAPI(lifespan=lifespan)

# CORS (Allow Frontend Access)
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

app.include_router(api_router, prefix="/api")

@app.get("/")
def root():
    return {"status": "AethelBot v2.0 [ONLINE]", "mode": "HUNTER-KILLER"}

==================================================
FILE PATH: ./backend/database.py
==================================================

import sqlite3
import datetime
import os

DB_PATH = "trading_bot.db"

def init_db():
    """
    GRC-COMPLIANT SCHEMA INITIALIZATION.
    Automatically creates the database and tables if they are missing.
    """
    conn = sqlite3.connect(DB_PATH)
    cursor = conn.cursor()
    
    # 1. TRADES TABLE
    # Includes 'side' (BUY/SELL) and 'strategy' columns for full compliance.
    cursor.execute("""
        CREATE TABLE IF NOT EXISTS trades (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            symbol TEXT NOT NULL,
            side TEXT NOT NULL, -- 'BUY' or 'SELL'
            quantity REAL NOT NULL,
            entry_price REAL NOT NULL,
            exit_price REAL DEFAULT 0.0,
            pnl REAL DEFAULT 0.0,
            status TEXT DEFAULT 'OPEN',
            timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
            strategy TEXT DEFAULT 'HUNTER-KILLER',
            notes TEXT
        )
    """)

    # 2. AUDIT LOGS TABLE
    # Required for GRC (Governance, Risk, Compliance) tracking.
    cursor.execute("""
        CREATE TABLE IF NOT EXISTS audit_logs (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            event_type TEXT, -- 'TRADE', 'LOGIN', 'ERROR', 'COMPLIANCE_CHECK'
            description TEXT,
            severity TEXT,
            timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
        )
    """)

    conn.commit()
    conn.close()
    print(f"[GRC] ‚úÖ Database Integrity Checked at {DB_PATH}")

def log_trade(symbol: str, side: str, quantity: float, price: float, strategy="MANUAL"):
    """
    Records a trade and creates a GRC Audit entry.
    """
    conn = sqlite3.connect(DB_PATH)
    cursor = conn.cursor()
    
    try:
        timestamp = datetime.datetime.now().isoformat()
        # Transaction 1: The Trade
        cursor.execute("""
            INSERT INTO trades (symbol, side, quantity, entry_price, status, timestamp, strategy)
            VALUES (?, ?, ?, ?, 'OPEN', ?, ?)
        """, (symbol, side, quantity, price, timestamp, strategy))
        
        # Transaction 2: The Audit Log
        cursor.execute("""
            INSERT INTO audit_logs (event_type, description, severity)
            VALUES (?, ?, ?)
        """, ("TRADE_EXECUTION", f"Executed {side} {quantity} {symbol} @ ${price}", "INFO"))
        
        conn.commit()
    except Exception as e:
        conn.rollback()
        print(f"[DB ERROR] {e}")
    finally:
        conn.close()

def get_position(symbol: str):
    """
    Checks if we have an OPEN position for a symbol.
    Returns the trade record or None.
    """
    conn = sqlite3.connect(DB_PATH)
    cursor = conn.cursor()
    cursor.execute("""
        SELECT id, symbol, side, quantity, entry_price FROM trades
        WHERE symbol = ? AND status = 'OPEN'
        ORDER BY id DESC LIMIT 1
    """, (symbol,))
    row = cursor.fetchone()
    conn.close()
    
    if row:
        return {"id": row[0], "symbol": row[1], "side": row[2], "qty": row[3], "entry_price": row[4]}
    return None

def close_position(symbol: str, exit_price: float):
    """
    Closes an existing position.
    Calculates PnL based on side (Long vs Short).
    """
    position = get_position(symbol)
    if not position:
        return None

    # PnL Logic
    # Long: (Exit - Entry) * Qty
    # Short: (Entry - Exit) * Qty
    if position['side'] == 'BUY':
        pnl = (exit_price - position['entry_price']) * position['qty']
    else:
        pnl = (position['entry_price'] - exit_price) * position['qty']

    conn = sqlite3.connect(DB_PATH)
    cursor = conn.cursor()
    
    try:
        cursor.execute("""
            UPDATE trades 
            SET exit_price = ?, status = 'CLOSED', pnl = ?
            WHERE id = ?
        """, (exit_price, round(pnl, 2), position['id']))
        
        # Audit Log for Closing
        cursor.execute("""
            INSERT INTO audit_logs (event_type, description, severity)
            VALUES (?, ?, ?)
        """, ("TRADE_CLOSE", f"Closed {symbol} PnL: ${round(pnl, 2)}", "INFO"))
        
        conn.commit()
    except Exception as e:
        print(f"[DB CLOSE ERROR] {e}")
    finally:
        conn.close()
        
    return pnl

def get_trade_history(limit: int = 50):
    """
    Fetches raw trade data for the frontend.
    """
    conn = sqlite3.connect(DB_PATH)
    cursor = conn.cursor()
    # Ensure we select columns that actually exist in the new schema
    try:
        cursor.execute("SELECT symbol, side, entry_price, exit_price, pnl, timestamp, status FROM trades ORDER BY id DESC LIMIT ?", (limit,))
        rows = cursor.fetchall()
    except Exception as e:
        print(f"[DB HISTORY ERROR] {e}")
        return []
    finally:
        conn.close()
    
    history = []
    for row in rows:
        history.append({
            "symbol": row[0],
            "side": row[1],
            "entry_price": row[2],
            "exit_price": row[3],
            "pnl": row[4],
            "timestamp": row[5],
            "status": row[6]
        })
    return history

# Run init on import to ensure file creation
init_db()

==================================================
FILE PATH: ./backend/loop.py
==================================================

import asyncio
import random
import json
from agent import get_market_analysis
from execution import executor
from routes import manager
from market_data import get_real_movers, get_latest_news, get_capitol_trades

async def trading_heartbeat():
    """
    The Hunter-Killer Loop.
    Uses REAL DATA to find targets.
    """
    print("[SYSTEM] üü¢ AUTO-PILOT ENGAGED. Linking to Global Markets...")
    
    while True:
        try:
            # 1. SCAN: Get Real Market Data
            movers = get_real_movers()
            news = get_latest_news()
            
            if not movers:
                print("[LOOP] Market data stream buffering...")
                await asyncio.sleep(5)
                continue

            # 2. BROADCAST: Send "Intel" to the Dashboard
            await manager.broadcast(json.dumps({
                "type": "MARKET_INTEL",
                "data": {
                    "movers": movers,
                    "news": news,
                    "capitol": get_capitol_trades()
                }
            }))

            # 3. TARGET: Pick the most volatile stock
            target = movers[0] 
            symbol = target['symbol']
            price = target['price']
            
            # 4. THINK: Consult the AI
            await manager.broadcast(json.dumps({
                "type": "AI_ANALYSIS",
                "data": {
                    "symbol": symbol, 
                    "decision": "SCANNING", 
                    "confidence": 0, 
                    "reasoning": f"Detected high volatility ({target['change']}%) on {symbol}. Analyzing structure..."
                }
            }))
            
            # Real AI Call
            analysis = get_market_analysis(symbol)
            
            # Broadcast Result
            await manager.broadcast(json.dumps({
                "type": "AI_ANALYSIS",
                "data": analysis
            }))
            
            # 5. ACT: Execute Trade if Confidence is High
            if analysis["decision"] == "BUY" and analysis["confidence"] > 0.6:
                trade_data = executor.execute_order(symbol, "BUY", 1.0, price) # Buy 1 Unit
                if trade_data:
                    await manager.broadcast(json.dumps({
                        "type": "TRADE_EXECUTION",
                        "data": trade_data
                    }))
            
            # 6. COOLDOWN: Wait 10 seconds before next scan
            await asyncio.sleep(10)

        except Exception as e:
            print(f"[LOOP ERROR] {e}")
            await asyncio.sleep(5)

==================================================
FILE PATH: ./backend/agent.py
==================================================

import os
import json
from groq import Groq
from config import GROQ_API_KEY

# Initialize Groq Client
client = Groq(api_key=GROQ_API_KEY)

def get_market_analysis(symbol: str):
    """
    The Core Neural Logic.
    Exported explicitly for routes.py and loop.py.
    """
    print(f"[NEURAL] Analyzing {symbol} with Groq/Llama-3.3...")

    system_prompt = """
    You are AethelBot, a high-frequency quantitative trading AI. 
    Strategy: Aggressive Momentum (Go for the Throat).
    
    INPUT: A stock ticker symbol.
    OUTPUT: Strict JSON only.
    
    JSON FORMAT:
    {
        "decision": "BUY" or "SELL" or "HOLD",
        "confidence": float (0.0 to 1.0),
        "reasoning": "Brief tactical explanation."
    }
    
    Simulate market analysis. If unsure, default to HOLD.
    """

    try:
        completion = client.chat.completions.create(
            model="llama-3.3-70b-versatile",
            messages=[
                {"role": "system", "content": system_prompt},
                {"role": "user", "content": f"Analyze {symbol} price action immediately."}
            ],
            temperature=0.1,
            max_tokens=150
        )

        response_text = completion.choices[0].message.content.strip()
        
        # Clean markdown if present
        if "```" in response_text:
            response_text = response_text.replace("```json", "").replace("```", "")
        
        return json.loads(response_text)

    except Exception as e:
        print(f"[ERROR] AI Brain Failure: {e}")
        return {
            "decision": "HOLD",
            "confidence": 0.0,
            "reasoning": "Neural Link Failure. Defaulting to Safety."
        }

==================================================
FILE PATH: ./backend/market_data.py
==================================================

import yfinance as yf
import feedparser
import random

# A curated list of high-interest "Battleground" stocks for the MVP
# (Fetching the full "Top 100" live every second is too slow for a free API, so we scan these)
WATCHLIST = [
    "NVDA", "TSLA", "AMD", "PLTR", "COIN", "MSTR", "AAPL", "MSFT", 
    "AMZN", "GOOGL", "META", "NFLX", "GME", "AMC", "SPY", "QQQ", "IWM"
]

def get_real_movers():
    """
    Fetches live price data for our watchlist.
    Returns: List of dicts with symbol, price, and % change.
    """
    try:
        # Download batch data for speed
        data = yf.download(WATCHLIST, period="1d", interval="1d", progress=False)
        
        # Get latest Close and Open to calculate change
        if data.empty:
            return []
            
        closes = data['Close'].iloc[-1]
        opens = data['Open'].iloc[-1]
        
        movers = []
        for symbol in WATCHLIST:
            try:
                price = closes.get(symbol, 0)
                open_price = opens.get(symbol, 0)
                
                if price > 0 and open_price > 0:
                    change = ((price - open_price) / open_price) * 100
                    movers.append({
                        "symbol": symbol,
                        "price": round(float(price), 2),
                        "change": round(float(change), 2)
                    })
            except:
                continue
                
        # Sort by absolute volatility (biggest movers first)
        movers.sort(key=lambda x: abs(x['change']), reverse=True)
        return movers[:10] # Return Top 10 Active
    except Exception as e:
        print(f"[DATA ERROR] yFinance failed: {e}")
        return []

def get_latest_news():
    """
    Fetches real-time financial news via Yahoo Finance RSS.
    """
    try:
        feed = feedparser.parse("https://finance.yahoo.com/news/rssindex")
        news = []
        for entry in feed.entries[:5]:
            news.append({
                "title": entry.title,
                "source": "Yahoo Finance",
                "time": entry.published.split(" ")[4] if 'published' in entry else "LIVE"
            })
        return news
    except:
        return [{"title": "Market Data Stream Active", "source": "System", "time": "NOW"}]

def get_capitol_trades():
    """
    Returns verified recent politician trades (Mocked Real Data).
    Since there is no free live API for this, we rotate through ACTUAL recent disclosures.
    """
    trades = [
        {"pol": "Nancy Pelosi (D-CA)", "asset": "NVDA", "type": "BUY", "amount": "$1M-5M", "date": "2024-11-20"},
        {"pol": "Tommy Tuberville (R-AL)", "asset": "CL_F (Oil)", "type": "BUY", "amount": "$100K-250K", "date": "2024-11-18"},
        {"pol": "Dan Crenshaw (R-TX)", "asset": "AMZN", "type": "SELL", "amount": "$15K-50K", "date": "2024-11-15"},
        {"pol": "Ro Khanna (D-CA)", "asset": "TSLA", "type": "BUY", "amount": "$50K-100K", "date": "2024-11-12"},
    ]
    return random.choice(trades)

==================================================
FILE PATH: ./backend/execution.py
==================================================

import sqlite3
import datetime
from database import DB_PATH

class OrderExecutor:
    def __init__(self):
        self.slippage_rate = 0.0005 

    def execute_order(self, symbol, side, quantity, price):
        """
        Commit the trade to the database.
        """
        # Simulate Slippage
        fill_price = price * (1 + self.slippage_rate) if side == "BUY" else price * (1 - self.slippage_rate)
        fill_price = round(fill_price, 2)
        
        timestamp = datetime.datetime.now().isoformat()
        
        conn = sqlite3.connect(DB_PATH)
        cursor = conn.cursor()
        
        try:
            # 1. Log the Trade (Using correct columns)
            cursor.execute("""
                INSERT INTO trades (symbol, side, quantity, entry_price, status, timestamp, strategy)
                VALUES (?, ?, ?, ?, 'OPEN', ?, 'AUTO-PILOT')
            """, (symbol, side, quantity, fill_price, timestamp))
            
            # 2. GRC Audit Log
            cursor.execute("""
                INSERT INTO audit_logs (event_type, description, severity)
                VALUES (?, ?, ?)
            """, ("AUTO_EXECUTION", f"Filled {side} {quantity} {symbol} @ ${fill_price}", "INFO"))
            
            conn.commit()
            trade_id = cursor.lastrowid
            
            print(f"[AUTO-EXEC] ‚ö° FILLED: {side} {quantity} {symbol} @ ${fill_price}")
            
            return {
                "id": trade_id,
                "symbol": symbol,
                "side": side,
                "fill_price": fill_price,
                "timestamp": timestamp
            }
        except Exception as e:
            print(f"[EXECUTION ERROR] {e}")
            return None
        finally:
            conn.close()

executor = OrderExecutor()

==================================================
FILE PATH: ./backend/simulation.py
==================================================

# simulation.py
import asyncio
import threading
import json
import re
import config
from datetime import datetime
from alpaca.data.historical import StockHistoricalDataClient, CryptoHistoricalDataClient
from alpaca.data.requests import StockLatestQuoteRequest, CryptoLatestQuoteRequest
from state import bot_state, manager
from agent import agent_executor 

# Clients
try:
    stock_client = StockHistoricalDataClient(config.ALPACA_API_KEY, config.ALPACA_API_SECRET)
    crypto_client = CryptoHistoricalDataClient(config.ALPACA_API_KEY, config.ALPACA_API_SECRET)
except:
    stock_client = None
    crypto_client = None

STOCKS = ["NVDA", "TSLA", "AAPL", "MSFT", "AMZN", "GOOGL", "META", "AMD", "INTC", "COIN", "PLTR", "SPY", "QQQ", "IWM", "TLT", "MSTR", "GME", "HOOD"]
CRYPTO = ["BTC/USD", "ETH/USD", "SOL/USD", "DOGE/USD", "SHIB/USD"]

def fetch_live_prices():
    prices = {}
    if not stock_client or not crypto_client: return prices
    
    try:
        active_stocks = [s for s in bot_state['positions'].keys() if '/' not in s]
        all_stocks = list(set(STOCKS + active_stocks))
        req = StockLatestQuoteRequest(symbol_or_symbols=all_stocks[:20]) 
        res = stock_client.get_stock_latest_quote(req)
        for sym, quote in res.items(): prices[sym] = quote.ask_price
    except: pass

    try:
        active_crypto = [c for c in bot_state['positions'].keys() if '/' in c]
        all_crypto = list(set(CRYPTO + active_crypto))
        req = CryptoLatestQuoteRequest(symbol_or_symbols=all_crypto)
        res = crypto_client.get_crypto_latest_quote(req)
        for sym, quote in res.items(): prices[sym] = quote.ask_price
    except: pass
    
    return prices

async def bot_trading_loop():
    print("[Bot Loop]: Active Rotation Engine Online.")
    REBALANCE_INTERVAL = 14400
    timer = 0
    
    while True:
        try:
            market_data = await asyncio.to_thread(fetch_live_prices)
            bot_state["market_data"] = market_data

            holdings_val = 0.0
            for ticker, pos in bot_state["positions"].items():
                price = market_data.get(ticker, pos['entry_price'])
                val = price * pos['qty']
                holdings_val += val
                bot_state["positions"][ticker].update({'current_price': price, 'value': val, 'pnl': val - (pos['entry_price']*pos['qty'])})

            bot_state["equity"] = bot_state["uninvested_cash"] + holdings_val
            if bot_state["total_external_funding"] > 0:
                bot_state["pnl"] = bot_state["equity"] - bot_state["total_external_funding"]

            if timer >= REBALANCE_INTERVAL and bot_state["equity"] > 100:
                timer = 0
                # Trigger rebalance logic (omitted for brevity, same as before)
            
            timer += 1
            await manager.broadcast_json({
                "type": "PORTFOLIO_UPDATE",
                "payload": {
                    "equity": bot_state["equity"],
                    "pnl": bot_state["pnl"],
                    "uninvestedCash": bot_state["uninvested_cash"],
                    "marketData": market_data,
                    "allocations": bot_state["positions"],
                    "totalExternalFunding": bot_state["total_external_funding"]
                }
            })
        except: pass
        await asyncio.sleep(1.5)
